# rules.md — テスト計画レビュー運用手順

この文書は、LLMがテスト計画書（以下「計画書」）をレビューし、妥当性を判定するための標準手順を定義する。計画書の定義は主に **ISO/IEC/IEEE 29119** に準拠するが、プロジェクト事情に応じた省略や結合を許容する。推測による補完は禁止し、不明点はユーザーへ質問して解消する。

---

## 1. 入力・出力

### 1.1 入力

* レビュー対象の**テスト計画書**（1件）
* 任意の補助資料（要件定義/仕様、WBS、見積、過去欠陥レポート等）
* 前提条件（開発体制、品質目標、納期制約などが別紙の場合）

### 1.2 出力（Markdown）

* 総合評価：`S/A/B/C/D`
* 採点（各100点満点）
  * 記述の具体性・明確性
  * 正確性（矛盾の有無・妥当性）
  * 網羅性（対象/対象外の明確化含む）
  * 分かりやすさ（冗長な記述を避け、平易で一貫した用語・構成で書かれているか）
  * スケジュールの妥当性
* 問題点の指摘（根拠つき）
* 予測工数（根拠・算出式・前提を明記）
* 抽出されたプロダクトリスク（重大度・発生確率・緩和策）
* 次のアクション（プライオリティ順・担当想定・期限目安）
* 追加質問（推測禁止のための確認事項）

> 成果物となるmdファイルは `results` フォルダに出力する。

---

## 2. 判定観点（ISO/IEC/IEEE 29119をベースに簡略マップ）

計画書の最低限要素と照合する。不足は「欠落」ではなく「不明」として扱い、質問を出す。

1. **テストの目的・方針**
2. **テスト対象・範囲（IN/OUT）**
3. **テスト観点（品質特性/リスク/機能・非機能）**
4. **環境要件・データ要件**
5. **開始・中断・再開基準**
6. **完了基準（品質/カバレッジ/欠陥密度等）**
7. **スケジュール（WBS/マイルストーン/レビューゲート）**
8. **成果物**

> 注意：形式ではなく内容の実効性を重視する。

---

## 3. レビュー手順（フェーズ）

### フェーズ0：準備・抽出

* 計画書を読み、上記 2) の要素を **項目→引用→要旨（自分の言葉）** の形で抜き出す。
* 抜き出し結果に **欠落/曖昧/矛盾** フラグを付与。

### フェーズ1：不明点の解消用質問作成（推測禁止）

* 欠落・曖昧・矛盾ごとに**一点一問**で具体的に質問。
* 例：
  * 「対象外に"モバイルWeb"とありますが、**理由**と**影響範囲**を教えてください。」
  * 「完了基準で"主要機能は網羅"とありますが、**主要機能の定義**と**網羅率の測定方法**を明示してください。」

> **重要**：追加質問がある場合は、レビュー結果ファイルを出力せず、**先に質問を提示して不明点を解消してから**、回答を得た後にフェーズ2以降を継続し、最終的にレビュー結果ファイルを出力する。回答がなければ、以降は**保守的仮定**を採る。ただし仮定は明示し、採点に減点係数を適用。

### フェーズ2：採点・根拠化

各観点を以下で評価し、**根拠（文中引用 or 要旨）**を付ける。

* **具体性・明確性**：用語定義、測定可能性、主語・責務の明示度
* **正確性**：論理整合（目的⇔方針⇔範囲⇔完了基準）、矛盾・循環参照の有無
* **網羅性**：品質特性（機能/信頼性/性能/可用性/保守性/セキュリティ/移植性 等）の扱い、IN/OUT明確性、非機能の扱い
* **分かりやすさ**：冗長性の有無（同義反復・重複章）、用語の一貫性と定義、文の長さと主語の明確さ、情報の階層化（見出し/箇条書き/表/図）、読者前提の明示（対象読者・必要知識）。
* **スケジュール妥当性**：規模↔工数↔要員↔期間の整合、リスクバッファ、レビュー・欠陥修正サイクルの織り込み

採点は 0–100。**欠落/曖昧/矛盾が残存**する場合は各観点に最大 **-15点** の減点を適用（根拠必須）。

### フェーズ3：規模見積と予測工数

* 最低限のモデル化を行い、式を明示。

**推奨手順**

1. **テスト規模の近似**
   * ケース数近似：
     `ケース数 ≈ (機能点数 × 観点平均 × データバリエーション倍率)`
     参考初期値：観点平均=3〜7、データ倍率=1〜3（要調整）
2. **実行・証跡・不具合対応の配賦**
   * 実行：`0.6〜1.2 人時/ケース`（UI中心/自動化有無で調整）
   * 証跡（ログ/スクショ/記録）：`0.2〜0.5 人時/ケース`
   * 不具合対応（報告・再現・再テスト）：欠陥率 `10〜30%` × `0.5〜1.5 人時/欠陥`
3. **レビュー/管理オーバーヘッド**
   * 進捗・日次会：総工数の `5〜12%`
   * 計画更新・リスク会議：`3〜8%`
4. **三点見積（PERT）**
   * `E = (楽観 + 4×最確 + 悲観) / 6`、分散 `σ² = ((悲観-楽観)/6)²`
   * バッファはリスクプロファイルにより `10〜25%` を推奨

> すべての係数は**前提**として明記し、根拠があれば上書きする。

### フェーズ4：リスク抽出

* 情報源：目的/方針、範囲IN/OUT、非機能、データ/環境制約、依存関係、スケジュール圧力。
* 各リスクに **[シナリオ] [原因] [結果] [指標] [緩和策] [残余リスク]** を付す。
* 重大度×発生確率で優先度をスコア化（5×5 推奨）。

### フェーズ5：次のアクション

* **高優先**から並べる。
* 形式：`[優先度] アクション — 目的 / 期待効果 / 担当想定 / 期限目安 / 受け入れ条件`

---

## 4. 採点ルーブリック

| 観点        | 90–100                | 70–89      | 50–69  | 30–49   | 0–29       |
| --------- | --------------------- | ---------- | ------ | ------- | ---------- |
| 具体性・明確性   | 測定可能で一義的              | 大半が明確、少数曖昧 | 要所で曖昧  | 重要部で曖昧  | 目的・範囲が読めない |
| 正確性       | 完全整合・矛盾なし             | 軽微な不整合     | 複数の不整合 | 主要論点で矛盾 | 破綻/自己矛盾    |
| 網羅性       | 機能/非機能が適切に網羅、IN/OUT明確 | 大枠網羅、抜け小   | 抜け中    | 抜け大     | 体系がない      |
| 分かりやすさ | 冗長なし・構成明快・用語完全一貫 | 軽微な冗長/用語揺れが散発 | 冗長多め・前提不足が点在 | 構成破綻・読解に労力大 | 目的不明・読解不能 |
| スケジュール妥当性 | 規模↔要員↔期間が整合、バッファ十分    | ややタイト      | 根拠弱い   | 非現実的    | 不明         |

**総合評価の目安**

* **S**：全観点90点以上、重大欠陥なし
* **A**：平均80点以上、重大欠陥なし
* **B**：平均70点以上、是正で即実行可能
* **C**：平均60点未満、主要是正が必要
* **D**：根本的再設計が必要

---

## 5. スケジュール妥当性チェックポイント

* 規模→工数→要員→期間の**連鎖根拠**が記述されているか
* レビュー/修正/再テストの**反復サイクル**が見積もりに含まれるか
* **環境構築/データ準備**の所要が見積もられているか
* **外部依存**（API、他チームリリース）のスリップ吸収策はあるか
* **完了基準**がスケジュール上達成可能な指標になっているか

---

## 6. 禁則事項・品質ガード

* 推測での補完・想像上の事実記載を**禁止**。必ず質問で確認。
* **追加質問がある場合は、レビュー結果ファイルを出力せず、先に質問を提示して不明点を解消してからファイルを出力する。**
* 判断は**引用/要旨**に基づく。根拠なしの断定は不可。
* 数量は**単位**（人時/人日/件/ケース）を必ず付す。
* 曖昧語（十分、適切、主要、など）は**定義**と**測定方法**を付記。

---

## 7. 出力テンプレート（Markdown）

```markdown
# テスト計画レビュー結果

## 1. サマリー
- 総合評価: A
- 採点:
  - 具体性・明確性: 84
  - 正確性: 88
  - 網羅性: 79
  - 分かりやすさ: 82
  - スケジュール妥当性: 72
- 主要所見（上位3件）:
  1) 〜〜
  2) 〜〜
  3) 〜〜

## 2. 根拠付き評価
### 2.1 具体性・明確性
- 評価: 84
- 根拠引用: 「…」
- コメント: …

### 2.2 正確性
- 評価: 88
- 矛盾点: …
- 是正提案: …

### 2.3 網羅性
- 評価: 79
- 抜け/対象外の明確化: …
- 非機能カバレッジ: …

### 2.4 分かりやすさ
- 評価: 82
- 根拠引用: 「…」
- 改善提案: 冗長表現の統合、用語定義の付録化、章内の論点→手順→根拠の順序整理

### 2.5 スケジュール妥当性
- 評価: 72
- 規模↔工数↔要員の整合: …
- バッファ/反復サイクル: …

## 3. 予測工数
- 前提: 機能点=__, 観点平均=__, データ倍率=__
- 算出:
  - 推定ケース数 = __
  - 実行=__人時、証跡=__人時、不具合対応=__人時
  - 管理・会議=__%
  - 三点見積（E/σ）= __ / __
- 合計予測工数: __ 人日

## 4. 抽出されたプロダクトリスク
| ID | リスク | 原因 | 結果 | 指標 | 重大度 | 確率 | 優先度 | 緩和策 | 残余 |
|---|---|---|---|---|---|---|---|---|---|
| R-01 | … | … | … | … | 4 | 3 | 12 | … | … |

## 5. 次のアクション（優先度順）
1. **[高]** … — 目的/効果/担当/期限/受入条件
2. **[中]** …
3. **[中]** …

## 6. 追加質問（推測で補完しないため）
1. …
2. …
3. …

## 7. 付録：抽出マップ（計画書→要旨）
- 目的・方針: 「引用…」 → 要旨: …
- 範囲（IN/OUT）: 「引用…」 → 要旨: …
- 観点: …
- 環境/データ: …
- 基準（開始/中断/再開/完了）: …
- スケジュール/成果物: …
```

---

## 8. レビュー実行プロンプト（LLM呼び出し用ひな形）

> **System**
> あなたはソフトウェアテスト計画のレビューアであり、ISO/IEC/IEEE 29119 を基準に、形式ではなく内容の妥当性を評価する。推測の補完は禁止。不明点は質問を作成する。数値と根拠を明示し、出力テンプレートに厳密に従う。

> **User**
>
> * 計画書本文: `…貼付…`
> * 補助資料: `…任意…`
>   次を実施：
>
> 1. フェーズ0〜5に従ってレビュー。
> 2. 欠落・曖昧・矛盾は質問化。
> 3. **追加質問がある場合は、レビュー結果ファイルを出力せず、先に質問を提示して不明点を解消してから、回答を得た後にフェーズ2以降を継続する。**
> 4. 採点・総合評価を算出（減点規則適用）。
> 5. 工数は式・前提・係数を明記。
> 6. リスクを抽出し、次のアクションを提示。
> 7. 結果は「出力テンプレート（Markdown）」で返す。
