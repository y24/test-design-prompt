# 非機能要求抽出ガイド

## 1. このガイドの目的

本ガイドは、要件定義書・利用手順書・仕様書・運用設計書などのドキュメントから、  
**非機能に関する情報（候補）を抜き出して整理する手順**を示す。

ここでいう「非機能候補」は、後続の作業（品質特性へのマッピング、品質基準・目標値の策定）の素材となる中間成果物である。

このガイドのゴールは次の通り。

- ドキュメント中に散在する非機能に関する文・記述を**漏れなく拾うこと**
- それぞれの文が、どのような観点（性能・信頼性・セキュリティなど）に関係しそうかを**ラフにタグ付けすること**
- 後続で判断・整理しやすいように、**出典情報（どの文書のどこか）を添えてリスト化**すること

本ガイドでは、**非機能を「完璧に分類する」ことよりも、「取りこぼさないこと」**を優先する。

---

## 2. インプットとアウトプット

### 2.1 インプット

LLM は、以下のようなドキュメントを入力として扱う。

- 要件定義書（ビジネス要件・非機能要件・制約事項 など）
- 利用手順書 / 操作マニュアル
- システム仕様書（機能仕様・非機能仕様）
- 運用設計書・監視設計書・バックアップ方針 など（存在する場合）
- システム構成図・ネットワーク構成図（テキスト化された説明を含む）
- プロジェクトの前提条件・制約（想定ユーザー数、利用時間帯、インフラ構成 など）

### 2.2 アウトプット

本ガイドの結果として、LLM は**非機能候補の一覧**を出力する。

1件の非機能候補について、以下の項目を持つことを推奨する。

- `nfr_candidate_id`  
  - 非機能候補を一意に識別する ID（例：NFR-001, NFR-002,…）

- `source_document`  
  - 出典となるドキュメントの名称（例：要件定義書、運用設計書）

- `source_location`  
  - 章番号・節番号・ページ番号・見出しなど（判別できる範囲でよい）

- `original_text`  
  - ドキュメント中の該当文（または文のまとまり）

- `reason_as_nfr_candidate`  
  - なぜ非機能候補と判断したかの簡単な説明

- `hint_quality_aspects`  
  - 関連しそうな品質特性の「候補タグ」  
    - 例：`["性能効率性", "信頼性"]`  
    - この時点ではラフでよく、確定ではない

- `notes`（任意）  
  - 不明点・曖昧な点・補足コメント

---

## 3. 全体の進め方（ステップ）

LLM は、非機能候補を抽出する際、次のステップを踏む。

1. **ドキュメント全体のざっくり把握**
2. **明示的な非機能セクションの抽出**
3. **明示的ではないが非機能を含む記述の抽出**
4. **暗黙の前提・制約からの非機能候補の抽出**
5. **重複整理と粒度調整**
6. **品質特性候補タグの付与（ラフなレベル）**

以降では、それぞれのステップでの考え方を具体化する。

---

## 4. ステップ 1: ドキュメント全体のざっくり把握

### 4.1 目的

- どのあたりに非機能っぽい情報が集中していそうかの**当たりをつける**。
- 必要な箇所を重点的に読むための準備。

### 4.2 やること

- 目次・章構成・大見出しをざっと読み、次のような箇所をメモする。
  - 「非機能要件」「性能要件」「運用」「セキュリティ」「制約」などの章
  - 「前提条件」「システム構成」「運用条件」「制限事項」などの章
- 利用手順書では、
  - 「注意事項」「補足」「トラブルシューティング」などの項目を確認する。

このステップではまだ抽出を行わず、「どの章に非機能が多そうか」を把握することを目的とする。

---

## 5. ステップ 2: 明示的な非機能セクションの抽出

### 5.1 目的

「非機能要件」としてまとめられている情報を**素直に拾う**。

### 5.2 対象となる典型的な章・見出しの例

- 「非機能要件」
- 「性能要件」「レスポンス要件」
- 「運用・監視要件」
- 「セキュリティ要件」
- 「信頼性」「可用性」「バックアップ」
- 「移行要件」「移植性」「プラットフォーム」など

### 5.3 抽出のポイント

- 箇条書きや表形式で列挙されている場合は、**1行 or 1セルを1候補**として抽出する。
- 1つの文が複数の観点を含む場合は、可能であれば「意味のかたまり」で分割してもよい。
- 次のような要素は、優先的に非機能候補として拾う。
  - 時間的な条件（○秒以内、○分以内、○時間以上稼働）
  - 量的な条件（○件以上、○ユーザー、○レコード）
  - 環境条件（OS、ブラウザ、ネットワーク）
  - 失敗・障害時の挙動（リトライ、ロールバック、フェイルオーバー）
  - セキュリティ・権限・監査に関する記述

---

## 6. ステップ 3: 明示的ではないが非機能を含む記述の抽出

### 6.1 目的

「機能説明の中にさりげなく書かれている非機能」を拾う。

### 6.2 典型的なパターン

1. **利用手順書の中の「注意書き」**
   - 例：
     - 「このボタンは 1 回だけ押してください。連続して押すと処理が重くなります。」
     - 「処理完了まで画面を閉じないでください。」

2. **仕様書の詳細説明の中の制約**
   - 例：
     - 「1 画面あたり最大 100 件まで表示する。」
     - 「エラー発生時はログに出力するが、画面には詳細を表示しない。」

3. **運用設計の中の条件**
   - 例：
     - 「バックアップは平日深夜に 1 回取得する。」
     - 「ログは 90 日間保管する。」

4. **システム構成図の説明文**
   - 例：
     - 「Web サーバーは冗長構成（2台）とする。」
     - 「インターネットからは直接 DB にアクセスできない。」

### 6.3 キーワードのヒント

以下のような単語や言い回しが含まれている文は、非機能候補である可能性が高い。

- 時間系：
  - 「〜秒以内」「〜分以内」「定期的に」「リアルタイム」「夜間」
- 量・規模系：
  - 「大量」「数十万件」「数千ユーザー」「ピーク時」
- 信頼性・可用性系：
  - 「冗長」「クラスタ」「フェイルオーバー」「再実行」「再起動」
- セキュリティ系：
  - 「ログイン」「権限」「暗号化」「アクセス制限」「社内ネットワークのみ」
- 運用・監視系：
  - 「監視」「アラート」「ログ」「バックアップ」「リストア」
- 保守・設定系：
  - 「設定ファイル」「構成情報」「拡張」「カスタマイズ」
- 環境系：
  - 「ブラウザ」「OS」「モバイル」「クラウド」「オンプレミス」

---

## 7. ステップ 4: 暗黙の前提・制約からの非機能候補抽出

### 7.1 目的

「直接は書かれていないが、どう考えても非機能に関係する前提」を見つける。

### 7.2 対象となる情報の例

- 想定ユーザー・利用場面
  - 例：「経理部が月末に集中して利用」「店舗から随時入力」
- システム構成・ネットワーク構成
  - 例：「インターネット VPN 経由で接続」「クラウドサービスと連携」
- 運用体制
  - 例：「24時間 365日 運用」「夜間のみバッチ実行」
- 法規制・社内規程
  - 例：「個人情報保護の観点から〜」「監査対応のため〜」

### 7.3 抽出のポイント

- 「この前提が変わると、どんな非機能の要求が変わりそうか？」を意識する。
  - 例：  
    - 「24時間 365日 運用」→ 信頼性・保守性・運用性に関する非機能候補が暗黙に存在。
    - 「経理部が月末に集中して利用」→ 性能効率性（ピーク負荷）、信頼性に関する非機能候補が暗黙に存在。
- ただし、**ここで新たな要件を「創作」してはいけない**。  
  - 「この前提から考えると、本来は〇〇が必要そうだ」という気づきは、
    - 非機能「候補」として記録する（`notes` に「推論ベース」と明示する）
    - 後続の「問題点の指摘」「次のアクション」で扱う

---

## 8. ステップ 5: 重複整理と粒度調整

### 8.1 重複の扱い

- 似たような文が複数のドキュメントに存在する場合：
  - どの文書・どの箇所に書かれているかは重要な情報なので、**出典はすべて保持**する。
  - ただし、同じ意味の非機能候補としてまとめられそうな場合は、1つの `nfr_candidate_id` に統合し、`source_document` / `source_location` を複数持たせる形でもよい。

### 8.2 粒度（どこまで分割するか）

- 1つの文の中に、明らかに別種類の非機能が混在している場合：
  - 例：
    > システムは 24時間 365日 利用可能であり、障害発生時には 1時間以内に復旧し、データが損失しないこと。
  - この場合、次のように分割してもよい。
    - 「24時間 365日 利用可能」→ 可用性・信頼性
    - 「1時間以内に復旧」→ 信頼性・運用
    - 「データが損失しない」→ 信頼性・セキュリティ（完全性）

- 逆に、細かく分割しすぎて意味が失われる場合は、**1つのかたまりとして残す**。

---

## 9. ステップ 6: 品質特性候補タグの付与（ラフなレベル）

### 9.1 目的

抽出した非機能候補に対し、「どの品質特性に関係しそうか」を**ラフにタグ付け**する。

- この時点では、ISO/IEC 25010 の 7 特性に**暫定的な候補タグ**をつければよい。
- 厳密な分類は、`quality_model_overview_guide.md` に基づく後続ステップで行う。

### 9.2 タグ付けの例

- 「処理時間」「同時接続」「大量データ」
  - ⇒ 性能効率性
- 「旧バージョンのデータ」「他システム連携」
  - ⇒ 互換性
- 「分かりやすい画面」「操作ステップ数」
  - ⇒ 使用性
- 「障害発生時の再実行」「無停止運用」
  - ⇒ 信頼性
- 「アクセス制限」「暗号化」「監査ログ」
  - ⇒ セキュリティ
- 「設定ファイル」「拡張しやすさ」「テスト容易性」
  - ⇒ 保守性
- 「複数 OS 対応」「クラウド移行しやすさ」
  - ⇒ 移植性

1つの候補に対し、複数のタグを付けてもよい。

---

## 10. 出力フォーマット例（非機能候補一覧）

非機能候補の一覧は、Markdown テーブル形式でまとめることを基本とする。

```markdown
### 非機能候補一覧（例）

| nfr_candidate_id | source_document | source_location       | original_text                                                                 | reason_as_nfr_candidate                                               | hint_quality_aspects               | notes                                 |
|------------------|-----------------|-----------------------|-------------------------------------------------------------------------------|------------------------------------------------------------------------|------------------------------------|----------------------------------------|
| NFR-001          | 要件定義書      | 3.2.1 インポート機能  | 月次締め処理のデータインポートは、業務開始前の 2時間以内に完了すること。       | 処理時間に関する明確な時間制約を含んでいるため。                      | 性能効率性, 信頼性                 | ピーク負荷条件の詳細は記載なし。       |
| NFR-002          | 要件定義書      | 3.2.1 インポート機能  | 旧バージョンでエクスポートした CSV ファイルを、本システムでインポートできる。 | 他バージョンとのデータ互換性に関する要件であるため。                  | 互換性, 性能効率性, セキュリティ   | データ量・ファイルサイズは未記載。     |
| NFR-003          | 利用手順書      | 2.1 取引登録          | 処理完了メッセージが表示されるまで、ブラウザを閉じないでください。           | 処理中の状態とユーザー操作に関する注意書きであり、性能・信頼性に関係。 | 性能効率性, 信頼性, 使用性         | 処理中表示や進捗表示の仕様は不明。     |
| NFR-004          | 運用設計書      | 4.1 バックアップ      | データベースのバックアップは平日深夜に 1日1回取得し、90日間保管する。        | バックアップ頻度と保管期間に関する運用要件であり、信頼性に関係。      | 信頼性, セキュリティ, 保守性       | RTO/RPO は明示されていない。           |
````

---

## 11. Few-Shot サンプル

### 11.1 入力例（要件断片）

次のような要件定義の断片が与えられたとする。

> 3.2 インポート機能
>
> * 月次締め処理のデータインポートは、業務開始前の 2時間以内に完了すること。
> * 旧バージョンでエクスポートした CSV ファイルを、本システムでインポートできること。
> * インポート処理中は、同一ユーザーからの重複実行を禁止すること。
> * インポート処理でエラーが発生した場合、エラー内容をログに記録し、ユーザーには簡潔なメッセージを表示すること。

### 11.2 非機能候補抽出の例

| nfr_candidate_id | source_document | source_location      | original_text                                                                 | reason_as_nfr_candidate                                              | hint_quality_aspects                     | notes                                       |
|------------------|-----------------|----------------------|-------------------------------------------------------------------------------|-----------------------------------------------------------------------|------------------------------------------|--------------------------------------------|
| NFR-101          | 要件定義書      | 3.2 インポート機能   | 月次締め処理のデータインポートは、業務開始前の 2時間以内に完了すること。       | 処理時間に関する明確な時間制約を含んでいるため。                     | 性能効率性, 信頼性                        | ピーク時のデータ量は記載がない。           |
| NFR-102          | 要件定義書      | 3.2 インポート機能   | 旧バージョンでエクスポートした CSV ファイルを、本システムでインポートできる。 | 他バージョンとのデータ互換性に関する要件であるため。                 | 互換性, 性能効率性, セキュリティ          | CSV スキーマの差異に関する説明は未記載。   |
| NFR-103          | 要件定義書      | 3.2 インポート機能   | インポート処理中は、同一ユーザーからの重複実行を禁止すること。               | 処理中状態とユーザー操作制御に関する要件であり、信頼性に関係する。   | 信頼性, 性能効率性, 使用性                | 具体的な UI 表示方法は仕様書側で要確認。   |
| NFR-104          | 要件定義書      | 3.2 インポート機能   | インポート処理でエラーが発生した場合、エラー内容をログに記録し、ユーザーには簡潔なメッセージを表示すること。 | ログ出力・ユーザー向けメッセージという非機能に関する要件であるため。 | 信頼性, セキュリティ（監査ログ）, 使用性 | ログ項目の詳細・保管期間は運用設計と要連携。 |

---

## 12. 禁止事項・注意点

1. **新しい非機能要件を勝手に追加しない**

   * ドキュメントに書かれていない要件を、「あたかも既定事項のように」追加してはならない。
   * 気づいた不足・違和感は、`notes` に「推論ベース」の旨を明記し、後続の「問題点の指摘」「次のアクション」で扱う。

2. **機能要件だけの文は、無理に非機能候補にしない**

   * 例：「取引登録ができること。」だけの文は、機能適合性に属し、ここでの非機能候補には含めない。
   * ただし、同じ節に性能や制約の記述がある場合は、その部分のみ抽出する。

3. **抽象度が高すぎる文の扱い**

   * 例：「使いやすいシステムとすること。」
   * このような文は、そのまま非機能候補として抽出しつつ、

     * `notes` に「具体的な基準が不足している」と記録し、
     * 後続の品質基準策定フェーズで具体化を検討する。

4. **粒度に悩んだ場合は、「少しだけ」細かくする側に寄せる**

   * 後で統合はしやすいが、あとから思い出して追加するのは難しいため、
     抽出段階では「取りこぼさないこと」を優先する。

---

以上の方針に従い、LLM は各ドキュメントから非機能候補を抽出し、
後続の `quality_model_overview_guide.md` および `quality_criteria_design_guide.md` による分析のための素材を作成すること。
