# function_identify_guide.md — 機能一覧の抽出プロンプト

このガイドは、利用手順書／仕様書／要件定義書などを入力に、**機能一覧（ツリー構造＋重要度付き）**を抽出して `result/function_list.md` を出力するためのプロンプト雛形です。
下のテンプレートを、そのままシステム／ユーザー／追加コンテキストに貼って使えるように分割しています。

---

## 1) 変数（置換用プレースホルダ）

* `{DOC_BUNDLE}`: 参照ドキュメント（本文、要点、見出し索引、章ページ情報のセット。複数可）
* `{PRIMARY_AXIS}`: ツリーの主軸（例：ドメイン→ユースケース、または ユースケース→画面）
* `{ABBREV_RULE}`: カテゴリ略号ルール（例：USER=ユーザ、ORD=受注…）
* `{CRITICALITY_RULE}`: 重要度判定基準（A/B/C/D の具体条件）
* `{SCOPE_NOTE}`: 対象範囲の特記事項（非機能を除外、ただし入力検証・権限差は含む等）
* `{KNOWN_CONSTRAINTS}`: 制約（ロール、外部連携、法令等）
* `{DOC_CITATION_STYLE}`: 出典表記の方法（文書名、章、見出し、URL/ページなど）

---

## 2) システムプロンプト（固定）

**[SYSTEM]**
あなたはソフトウェアQAの機能分析アシスタント。
与えられたドキュメントから**機能**を抽出し、以下を満たす **機能一覧** を設計・出力する。

* 粒度は原則 **L1=機能群 / L2=機能 / L3=サブ機能・操作**。必要なら層を±1拡張。
* すべての行に **重要度(A/B/C/D)** と **出典** を付与。
* 結果は **Markdown** で、先頭に**サマリツリー**、続けて**表**を出力。
* 画面＝機能と短絡せず、**ユースケース（目的）** を軸に正規化する。
* 不明点や仮説は「不明点/仮定」列に、短文で可視化する。
* 出力は **`result/function_list.md`** の内容としてそのまま使える形に整える。
* 非機能（性能、可用性、セキュリティ等）は除外。ただし**入力検証・権限差・状態遷移**は機能観点として扱う。
* トレーサビリティ確保のため、ID採番ルールに従う（`FUNC-<略号>-<連番>`）。

---

## 3) ユーザープロンプト（雛形）

**[USER]**
以下の資料をもとに、アプリケーションの**機能一覧**を抽出して `result/function_list.md` の内容として出力して。
出力仕様は「出力フォーマット」を厳守し、「抽出アルゴリズム」と「重要度判定」を適用すること。

### 入力資料

```
{DOC_BUNDLE}
```

### スコープ/前提

* {SCOPE_NOTE}
* 既知の制約: {KNOWN_CONSTRAINTS}

### ツリー主軸

* {PRIMARY_AXIS}

### ID採番・略号

* カテゴリ略号ルール: {ABBREV_RULE}
* 機能ID: `FUNC-<カテゴリ略号>-<3桁連番>`（カテゴリごとに採番）

### 重要度の定義

* {CRITICALITY_RULE}

### 出典表記

* {DOC_CITATION_STYLE}

### 抽出アルゴリズム（適用手順）

1. **候補収集**：目次・章見出し・機能説明・UI操作手順・API一覧・バッチ/ジョブ・入出力仕様から機能候補を網羅取得。
2. **正規化**：同義語・UI名・API名のぶれを、ユースケースの目的で統合。
3. **ツリー化**：{PRIMARY_AXIS} に従い、`カテゴリ/サブカテゴリ/.../機能` の**パス化**。
4. **粒度調整**：L2で目的が一意に言えるか、L3で具体分岐（入力制約、状態差、権限差）が見えるかを確認。
5. **重要度評価**：定義に基づき A/B/C/D を採番。根拠を簡潔にメモ。
6. **前提/依存**：ログイン、権限、外部連携、事前データなどを明示。
7. **主要入出力**：代表的な入力項目・出力（生成物、通知、API応答）を記載。
8. **欠落検知**：CRUDの抜け、エラー再試行、インポート/エクスポート、スケジューラ/ジョブ、設定画面に紐づく影響機能を点検。
9. **品質ゲート**：全行に重要度と出典があること、L2網羅と代表L3分岐があることを自己検査。

### 出力フォーマット（厳守）

* 先頭に**ツリーサマリ**（Markdown箇条書き。各ノードの末尾に `[A/B/C/D]` を付与）
* 続いて**機能一覧表**（Markdown表）。列は下記順。

| Function ID | 名称 | カテゴリパス | 概要 | 重要度 | 前提/依存 | 主要入力/出力 | 出典 | 不明点/仮定 |
| ----------- | -- | ------ | -- | --- | ----- | ------- | -- | ------ |

> 余計な解説は出力しない。`result/function_list.md` としてそのまま保存可能な本文のみを返す。

---

## 4) 重要度判定テンプレ（編集可）

**{CRITICALITY_RULE} の例**

* **A（必須/致命）**：法令・会計/課金などの基幹、支払い/受注確定、外部機関・取引先連携の中核、データ破壊/漏えいに直結
* **B（高）**：高頻度の主要業務、失敗時の業務停止・顧客影響大、SLA/KPI直結
* **C（中）**：一般業務。代替/再実行が容易、影響限定的
* **D（低）**：周辺・希少操作、閲覧系のみ、学習用/補助的

根拠メモ例：`[頻度:高][金額影響:大][規制:有][外部API:必須]`

---

## 5) Few-shot（小規模サンプル）

### 入力断片（例）

* 文書A §3.1「ユーザ管理」：管理者はユーザを作成/編集/無効化できる。メールは一意、初期ロールは「一般」。
* 文書B §5.2「CSV一括登録」：UTF-8, ヘッダ必須。失敗は行単位でレポート生成。
* 文書C §7.4「権限」：閲覧者は参照のみ。一般は自分のプロフィール編集可。

### 期待されるツリーサマリ（抜粋）

* 管理/ユーザ

  * 登録 `[A]`
  * 編集 `[B]`
  * 無効化 `[B]`
  * 一括登録（CSV） `[B]`
* アカウント/プロフィール

  * 自分のプロフィール編集 `[C]`

### 期待される表（抜粋）

| Function ID   | 名称       | カテゴリパス          | 概要           | 重要度 | 前提/依存             | 主要入力/出力                 | 出典       | 不明点/仮定       |
| ------------- | -------- | --------------- | ------------ | --- | ----------------- | ----------------------- | -------- | ------------ |
| FUNC-USER-001 | ユーザ登録    | 管理/ユーザ/登録       | 管理者が新規ユーザを作成 | A   | 管理者権限、メール一意       | 入:メール/ロール/氏名 出:ユーザID/通知 | 文書A §3.1 | 初期ロールの変更可否   |
| FUNC-USER-004 | CSV一括登録  | 管理/ユーザ/一括登録     | CSVで複数ユーザを登録 | B   | 管理者権限、UTF-8、ヘッダ必須 | 入:CSVファイル 出:結果レポート      | 文書B §5.2 | ファイル上限サイズ未記載 |
| FUNC-ACCT-002 | プロフィール編集 | アカウント/プロフィール/編集 | 一般ユーザが自身を編集  | C   | ログイン済み、本人のみ       | 入:氏名/アイコン 出:更新結果        | 文書C §7.4 | 項目の最大長       |

---

## 6) 抜け漏れ防止チェックリスト

* CRUDのC/U/Dが揃っているか（実体ごと）
* インポート/エクスポート/CSV/ジョブ/スケジュール
* エラー再試行、部分成功、結果レポート、通知/監査ログ
* 権限差（管理者/一般/閲覧）、本人対象操作
* 状態遷移（有効/無効、下書き/確定、ロック、アーカイブ）
* 外部API/決済/課税/タイムゾーン/番号体系

---

## 7) よくある曖昧さへの対処

* 画面名しかない → ボタン/操作の**目的**に言い換えて機能化。
* 「設定」一括記載 → **設定が影響する機能**を列挙し、設定自体は周辺カテゴリへ。
* APIのみ定義 → エンドユーザの目的に合わせて**ユースケース化**（例：インポートAPI→「一括登録」）。
* 複合操作 → L2に目的、L3に分岐（重複、境界、フォーマット不正、外部失敗）。

---

## 8) 実行時のコマンド（任意メモ）

* 生成物は `result/function_list.md` に出力される前提で、ツール側で保存する。
* セクションごとに長大になる場合、カテゴリ単位で見出しを分けて表を分割してよい。

---

## 9) 出力のヘッダ雛形（そのまま先頭に付与してよい）

```
# 機能一覧（ツリー＋重要度付き）
# 生成物: result/function_list.md
# 生成日時: <自動>
# 出典: {DOC_CITATION_STYLE}
```
