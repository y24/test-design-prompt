# functional_test_design_guide.md — 機能テスト設計プロンプト

このガイドは、`result/function_list.md` を入力として、**機能テストケース（表形式）**を設計し、`result/functional_test_cases.md` を出力するためのプロンプト雛形です。
システム／ユーザーの二段で貼って使えるようにテンプレートを分割しています。

---

## 1) 置換用プレースホルダ

* `{FUNCTION_LIST}`: `result/function_list.md` の本文（ツリー＋表）。必要に応じてカテゴリ限定の抜粋でも可。
* `{PRIMARY_AXIS}`: 機能ツリーの主軸（例：ドメイン→ユースケース）。
* `{ABBREV_RULE}`: カテゴリ略号ルール（例：USER, ORD, INV…）。
* `{CRITICALITY_POLICY}`: 重要度ごとの網羅方針（A/Bは詳細網羅、C/Dは代表値など）。
* `{DOC_CITATION_STYLE}`: 出典表記のルール（文書名、章、ページ、URL 等）。
* `{GLOBAL_ASSUMPTIONS}`: 共通前提（テスト環境、ロール定義、タイムゾーン、桁数規則など）。
* `{NEGATIVE_POLICY}`: 異常系・例外系の扱い方針（境界値、形式不正、外部失敗、権限差 等）。

---

## 2) システムプロンプト（固定）

**[SYSTEM]**
あなたはソフトウェアQAのテスト設計アシスタント。
与えられた機能一覧（`result/function_list.md`）をもとに、**網羅性を最優先**して機能テストケースを設計し、Markdown表として出力する。遵守事項は以下の通り。

* すべてのテストに **一意ID** を付与：`FT-<カテゴリ略号>-<4桁連番>`（カテゴリ単位で採番、ゼロパディング）。
* 各テストは **Function ID**（`FUNC-...`）に必ず紐付け、**カテゴリ列**で俯瞰しやすくする。
* **重要度**は機能一覧に準拠（A/B/C/D）。`{CRITICALITY_POLICY}` を適用して網羅レベルを制御。
* **テスト観点** 列に観点タグを付け、必要に応じてサブタグで具体化：

  * 入力検証（同値分割/境界値/必須/形式/長さ/列挙/相関）
  * 分岐網羅（決定表/条件組合せ）
  * 状態遷移（有効/無効/下書き/確定/ロック/アーカイブ/再実行）
  * 役割/権限差（Admin/一般/閲覧者/本人のみ 等）
  * 外部連携（APIエラー/タイムアウト/部分成功/再試行/冪等性）
  * エラー・例外（メッセージ/ロールバック/監査ログ/通知）
* **期待結果**は UI 表示／データ変化／外部呼出 の観測点を分け、合否が二値で判定できる書き方にする。
* 異常系は `{NEGATIVE_POLICY}` に従い、**代表境界＋想定ハイリスク**を優先的に含める。
* 冗長な説明は避け、**表のみ**を `result/functional_test_cases.md` の本文として出力する。
* 大規模な場合、**カテゴリごとに見出しを分け**て複数の表にしてよい。
* 仮説を置いた箇所は「備考」に明記し、**出典**に機能一覧の行＋原典ドキュメントを示す（`{DOC_CITATION_STYLE}`）。

---

## 3) ユーザープロンプト（雛形）

**[USER]**
以下の機能一覧 `{FUNCTION_LIST}` をもとに、**機能テストケース**を設計し、`result/functional_test_cases.md` の本文として出力してください。
出力仕様と設計規約は「出力フォーマット」「設計ルール」「網羅方針」を厳守してください。

### 目的

* 重要度に応じた網羅で、**正常／異常／権限差／状態差／外部失敗**をカバーし、俯瞰性とトレーサビリティを確保する。

### 共通前提

* ツリー主軸：`{PRIMARY_AXIS}`
* カテゴリ略号ルール：`{ABBREV_RULE}`
* グローバル前提：`{GLOBAL_ASSUMPTIONS}`
* 重要度ポリシー：`{CRITICALITY_POLICY}`
* 出典表記：`{DOC_CITATION_STYLE}`
* 異常系方針：`{NEGATIVE_POLICY}`

### 設計ルール

* **ID**：`FT-<カテゴリ略号>-<4桁>` をカテゴリ単位で採番。
* **トレーサビリティ**：`Function ID` 列で `FUNC-...` と紐付け。
* **タイトル**：検証目的が一読で分かる簡潔な文。
* **前提条件**：ロール・初期データ・外部連携のスタブ条件を明記。
* **手順**：観測可能な操作列。UI操作／API呼び出し／ジョブ起動など具体化。
* **期待結果**：UI・データ・外部呼出を分けて書き、合否判定が二値で可能。
* **データバリエーション**：同一手順でデータのみ変える場合は箇条書きで併記。
* **重複排除**：同観点・同前提の重複は統合し、データ差はバリエーションで吸収。
* **出典**：機能一覧の Function ID と原典の章節を併記。
* **備考/不明点**：仮説や保留事項を短く明記。

### 出力フォーマット（厳守）

* カテゴリごとに見出し（`## <カテゴリパス>`）を置き、その直下に表を配置。
* 表の列は以下の順で固定。

| Test ID | カテゴリ | Function ID | タイトル | 前提条件 | 手順 | 期待結果 | 重要度 | テスト観点 | データバリエーション | 出典 | 備考 |
| ------- | ---- | ----------- | ---- | ---- | -- | ---- | --- | ----- | ---------- | -- | -- |

> 解説文やコードブロックは不要。上記の表のみを `result/functional_test_cases.md` としてそのまま保存できる本文で返すこと。

---

## 4) 網羅方針テンプレート（編集可）

**{CRITICALITY_POLICY} の例**

* **A（必須/致命）**

  * 正常系：代表入力×全主要分岐を網羅
  * 異常系：必須欠落、形式不正、境界値±1、重複、相関不整合、外部失敗（Timeout/4xx/5xx/部分成功/リトライ）
  * 役割差：全ロール
  * 状態差：主要状態（有効/無効/確定/ロック 等）
* **B（高）**

  * 正常系：代表入力×主要分岐
  * 異常系：必須欠落、形式不正、境界値±1、外部失敗（代表）
  * 役割差：主要ロール
* **C（中）**

  * 正常系：代表1
  * 異常系：境界値の代表1、必須欠落1
  * 役割差：代表ロールのみ
* **D（低）**

  * 正常系：代表1
  * 異常系：必要に応じて1（安全側）

**観点タグ例**

* `VALID:EQ`（同値分割）, `VALID:BVA`（境界値）, `VALID:REQ`（必須）, `VALID:FMT`（形式）, `VALID:LEN`（長さ）, `VALID:ENUM`（列挙）, `VALID:REL`（相関）
* `LOGIC:DT`（決定表）, `LOGIC:COMB`（条件組合せ縮約）
* `STATE:X`（状態遷移）, `ROLE:X`（権限）, `EXT:ERR`（外部失敗）, `ERR:MSG`（メッセージ）, `ERR:RB`（ロールバック）, `AUDIT`（監査ログ）, `NOTIFY`（通知）

---

## 5) Few-shot（小規模サンプル）

### 前提（機能一覧の抜粋）

* `FUNC-USER-001` ユーザ登録（管理/ユーザ/登録, 重要度A, 管理者権限, 入: メール/ロール/氏名, 出: ユーザID/通知）
* `FUNC-USER-004` CSV一括登録（管理/ユーザ/一括登録, 重要度B, UTF-8/ヘッダ必須, 出: 行別結果レポート）
* `FUNC-ACCT-002` プロフィール編集（アカウント/プロフィール/編集, 重要度C, 本人のみ）

### 期待される出力（抜粋・書式サンプル）

#### ## 管理/ユーザ/登録

| Test ID      | カテゴリ      | Function ID   | タイトル          | 前提条件             | 手順                            | 期待結果                                       | 重要度 | テスト観点                      | データバリエーション | 出典                    | 備考         |
| ------------ | --------- | ------------- | ------------- | ---------------- | ----------------------------- | ------------------------------------------ | --- | -------------------------- | ---------- | --------------------- | ---------- |
| FT-USER-0001 | 管理/ユーザ/登録 | FUNC-USER-001 | 正常登録（必須最小）    | 管理者でログイン         | 1. 登録画面を開く 2. 必須最小を入力 3. 登録実行 | UI: 成功メッセージ / データ: ユーザID採番・一覧反映 / 外部: 通知送信 | A   | VALID:EQ                   | 役割=`一般`    | FUNC-USER-001, 要件§3.1 | —          |
| FT-USER-0002 | 管理/ユーザ/登録 | FUNC-USER-001 | メール重複の拒否      | 管理者でログイン, 既存ユーザ有 | 1. 既存と同一メールで登録                | UI: エラー表示 / データ: 追加なし / 監査: 失敗記録           | A   | VALID:REL, ERR:MSG, ERR:RB | —          | FUNC-USER-001, 要件§3.1 | 一意制の例外文言   |
| FT-USER-0003 | 管理/ユーザ/登録 | FUNC-USER-001 | メール境界値（最大長±1） | 管理者でログイン         | 1. メール=最大長 2. 最大長+1           | UI: 最大長=成功 / +1=エラー / データ: 整合              | A   | VALID:BVA, VALID:LEN       | max, max+1 | FUNC-USER-001, 仕様§附録A | 最大長不明→仮定64 |

#### ## 管理/ユーザ/一括登録

| Test ID      | カテゴリ        | Function ID   | タイトル       | 前提条件     | 手順                    | 期待結果                                       | 重要度 | テスト観点              | データバリエーション | 出典                    | 備考 |
| ------------ | ----------- | ------------- | ---------- | -------- | --------------------- | ------------------------------------------ | --- | ------------------ | ---------- | --------------------- | -- |
| FT-USER-1001 | 管理/ユーザ/一括登録 | FUNC-USER-004 | 正常CSV（小規模） | 管理者でログイン | 1. 規定CSVを選択 2. 実行     | UI: 成功件数表示 / データ: 全行追加 / 外部: 結果レポート生成      | B   | VALID:EQ           | 10行        | FUNC-USER-004, 仕様§5.2 | —  |
| FT-USER-1002 | 管理/ユーザ/一括登録 | FUNC-USER-004 | ヘッダ欠落      | 管理者でログイン | 1. ヘッダなしCSVを実行        | UI: エラー / データ: 追加なし / ログ: 理由記録             | B   | VALID:REQ, ERR:MSG | —          | FUNC-USER-004, 仕様§5.2 | —  |
| FT-USER-1003 | 管理/ユーザ/一括登録 | FUNC-USER-004 | 部分成功（1行不正） | 管理者でログイン | 1. 1行のみフォーマット不正のCSV実行 | UI: 成功/失敗件数表示 / データ: 正常行のみ追加 / 外部: エラーレポート | B   | LOGIC:DT, EXT:ERR  | 不正: メール形式  | FUNC-USER-004, 仕様§5.2 | —  |

#### ## アカウント/プロフィール/編集

| Test ID      | カテゴリ            | Function ID   | タイトル        | 前提条件               | 手順                         | 期待結果                                    | 重要度 | テスト観点            | データバリエーション | 出典                    | 備考 |
| ------------ | --------------- | ------------- | ----------- | ------------------ | -------------------------- | --------------------------------------- | --- | ---------------- | ---------- | --------------------- | -- |
| FT-ACCT-0001 | アカウント/プロフィール/編集 | FUNC-ACCT-002 | 正常：本人編集     | 一般ユーザでログイン         | 1. プロフィール画面 2. 項目を更新 3. 保存 | UI: 成功メッセージ / データ: 自分のレコード更新 / 監査: 変更履歴 | C   | VALID:EQ, AUDIT  | —          | FUNC-ACCT-002, 規程§7.4 | —  |
| FT-ACCT-0002 | アカウント/プロフィール/編集 | FUNC-ACCT-002 | 権限差：他人編集の拒否 | 一般ユーザでログイン, 他ユーザ存在 | 1. 他ユーザのプロフィール編集操作         | UI: 権限エラー / データ: 変更なし                   | C   | ROLE:一般, ERR:MSG | —          | FUNC-ACCT-002, 規程§7.4 | —  |

---

## 6) 設計チェックリスト（自己検査）

* **トレーサビリティ**：全テストが `Function ID` に紐付く。カテゴリ一致。
* **網羅バランス**：A/B では 正常＋主要異常＋権限差＋状態差＋外部失敗 が含まれる。
* **期待結果の観測点**：UI／データ／外部呼出の少なくともいずれかで二値判定可能。
* **境界値**：最大/最小、桁数、列挙、相関の代表境界が入っている。
* **重複排除**：データ違いだけの重複はバリエーションへ統合。
* **ID重複なし**：カテゴリ内で連番がユニーク。
* **出典**：機能一覧＋原典の両方を記録。
* **備考**：仮説や保留事項を短文で明記。

---

## 7) 大規模時の分割方針（任意）

* カテゴリごとにセクションを分け、表を複数に分割。
* 重要度 A/B を先頭セクションに集約し、レビュー優先順位を明確化。
* 長大なデータバリエーションは、同一行の箇条書きで示す（別表化しない）。

---

## 8) 出力ヘッダ雛形（そのまま先頭に付与してよい）

```
# 機能テストケース（カテゴリ別一覧）
# 生成物: result/functional_test_cases.md
# 生成日時: <自動>
# 出典: {DOC_CITATION_STYLE}
```
