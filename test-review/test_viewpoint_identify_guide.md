# test_viewpoint_identify_guide.md — テスト観点抽出プロンプトガイド

この文書は、LLM に対して「利用手順書/仕様書/要件定義書（以下、元ドキュメント）」を読み取り、**テスト観点**を体系的に抽出させるためのプロンプト指示テンプレートである。出力は `Markdown` 固定。抽出結果は後続の `test_review_guide.md` でテストケース（CSV）と照合される。

## 関連ドキュメント

* **`rules.md`**: 全体のルール、採点基準、スコア算出方法を定義（本ガイドのリスク評価ルーブリックは独自定義）
* **`test_review_guide.md`**: 本ガイドで抽出した観点を使用してテストケースをレビューする手順

---

## 1. ゴールと出力定義

* ゴール: 仕様/要件に基づき、**正常系 / 準正常系 / 異常系 / 非機能** の観点を過不足なく抽出し、**リスクに基づく優先度**を付与する。
* 出力形式（Markdown）

  * 観点リスト（表形式）と所感サマリ（箇条書き）を含める。
  * 表の列定義は §6 の**出力テンプレート**に厳密に従う。

---

## 2. 前提入力

1. 元ドキュメント（複数可、版/日付/適用範囲つき）
2. システム全体像の補助資料（任意: 画面遷移図、ER 図、API 定義等）
3. チームが重視する観点（任意: 例「境界値と権限まわりを重点」）

---

## 3. 抽出ポリシー

* **分類必須**: `TestCaseType` を `Normal | Quasi | Abnormal | NonFunctional` のいずれかで付与。

  * Normal: 主要フローで想定成功。
  * Quasi: 想定内エラー/回復可能な分岐（境界・入力揺れ・軽微な障害）。
  * Abnormal: 想定外または安全側に倒すべき異常（例: 通信断、整合性崩壊）。
  * NonFunctional: 性能、セキュリティ、可用性、操作性、監査、アクセシビリティ等。
* **リスク駆動**: 各観点に `RiskScore` と `RiskDetail` を付与し、優先度決定に使う。
* **根拠主義**: すべての観点に、元ドキュメントの**出典（節/表/図/API 名/行）**を `SourceRef` として必ず付与。
* **重複抑制**: 同義/包含関係を検出し、`Duplicates` に関連 ID を記す。
* **スコープ明確化**: 仕様外/曖昧は `Assumptions` に仮定として明示。提案は提案と注記。

---

## 4. リスク評価ルーブリック

* スコア設計（0–100）: `RiskScore = ceil( Impact(1–5) × Likelihood(1–5) × 4 )`

  * Impact（影響）: 1=軽微, 3=ユーザ業務に支障, 5=重大損失/法令/安全
  * Likelihood（発生）: 1=稀, 3=ときどき, 5=頻発/再発高
* 便宜的ランク: `High (≥80) / Medium (50–79) / Low (<50)`
* `RiskDetail` には**理由**（障害費用、利用頻度、変更点、制御不能性、監査要件等）を1行で記載。

---

## 5. 抽出手順（LLMへの指示）

1. **スコープ確定**: ドキュメントの目的/対象/非対象/前提/用語を要約。曖昧は `Assumptions` に列挙。
2. **機能分解**: ユースケース/業務フロー/API/画面単位に分解し、**CRUD×境界**×権限×状態遷移を軸に観点候補を列挙。
3. **分類付与**: 候補に `TestCaseType` を割当（Normal/Quasi/Abnormal/NonFunctional）。
4. **観測点の明文化**: 各観点に**観測可能性**（UI/ログ/DB/API/メトリクス）を `Observability` に記述。
5. **データ前提の抽出**: 権限/日時/通貨/在庫/締日/桁数/エンコード等の**テストデータ条件**を `DataNeeds` に明記。
6. **リスク採点**: §4で `RiskScore` を算出し、`RiskRank` を自動付与。
7. **重複/包含整理**: 似た観点は統合し、`Duplicates` に関連 ID を記す。
8. **サマリ**: 観点の偏り（Normal/Quasi/Abnormal/NonFunctional の比率）と盲点を要約。

---

## 6. 出力テンプレート（Markdown厳守）

```markdown
# 観点抽出結果

## サマリ
- 文書: <名称/版/日付>
- 対象範囲: <機能/画面/ユースケース等>
- 抽出件数: <n>（Normal:<n>, Quasi:<n>, Abnormal:<n>, NonFunctional:<n>）
- 盲点/留意: <簡潔に>

## 観点リスト
| ViewpointID | Title | TestCaseType | Description | SourceRef | RiskScore | RiskRank | RiskDetail | Preconditions | DataNeeds | Observability | Tags | Duplicates | Assumptions |
|---|---|---|---|---|---:|---|---|---|---|---|---|---|---|
| VP-001 | <短い名称> | Normal | <何を検証するかを一文で> | <章/節/表/図/API/行> | 80 | High | <理由> | <前提> | <データ条件> | <UI/ログ/DB/API> | <任意> | <関連ID> | <仮定> |
| VP-002 | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

## 所感
- 偏り: Normal が多く Abnormal が手薄。入力検証と通信エラーを追加推奨。
- 非機能: 性能/監査ログ/権限の組合せが不足。
- 重要領域: <例: 決済確定/締処理/ロールバック> が High 多数。
```

---

## 7. 抽出のための観点ヒューリスティクス

* **データ境界**: 最小/最大/空/Null/全角半角/エンコード/時刻境界（月末/閏年/タイムゾーン）。
* **権限/ロール**: 未ログイン/期限切れ/権限なし/権限昇格/兼務ロールの衝突。
* **状態遷移**: 新規→承認→確定→取消→再承認、途中参照・並行更新、取り消しの副作用。
* **トランザクション**: 部分成功、二重実行、リトライ/タイムアウト、同時更新、ロック競合。
* **外部連携**: API スキーマ不一致、部分ダウン、レート制限、非同期遅延。
* **監査/ログ**: 誰が/いつ/何を/どこから、追跡性、整合性、改ざん検知。
* **国際化**: 通貨/桁区切り/日付/言語/並び替え/文字化け。
* **アクセシビリティ**: キーボード操作、スクリーンリーダ、コントラスト、フォーカス順。
* **性能/容量**: バッチ件数、N+1、キャッシュ失効、スロークエリ、ピーク負荷。

---

## 8. Few-shot 例（最少）

### 8.1 例A: ログイン/ロックアウト

**入力要約**: ユーザはメールアドレスとパスワードでログイン。連続5回失敗で15分ロック。パスワードは8–64 文字。失敗時は一般的メッセージ。監査ログ必須。

**出力（抜粋）**

| ViewpointID | Title   | TestCaseType      | Description                 | SourceRef | RiskScore | RiskRank | RiskDetail    | Preconditions | DataNeeds          | Observability        | Tags       | Duplicates | Assumptions |
| ----------- | ------- | ------------- | --------------------------- | --------- | --------: | -------- | ------------- | ------------- | ------------------ | -------------------- | ---------- | ---------- | ----------- |
| VP-LOGIN-01 | 正常ログイン  | Normal        | 有効資格情報でセッション発行しダッシュボードに遷移する | §2.1, 図1  |        72 | Medium   | 利用頻度高、回帰リスク   | ユーザ有効         | 既存ユーザ: active=true | UI遷移/Set-Cookie/監査ログ | auth       |            |             |
| VP-LOGIN-02 | 入力境界    | Quasi         | メール/パスワードの桁数・形式の境界で妥当性検証する  | §2.2, 表A  |        64 | Medium   | 入力不備は多発       | 未ログイン         | 最短/最長/空/全角混在       | UIバリデーション/ログ         | validation |            |             |
| VP-LOGIN-03 | 連続失敗ロック | Abnormal      | 失敗5回で15分ロックし、期間中は拒否される      | §2.3      |        88 | High     | 認証回りは攻撃対象/苦情大 | 未ログイン         | 失敗回数=5             | UIエラー/監査ログ/レート制限     | security   |            |             |
| VP-LOGIN-04 | 監査ログ    | NonFunctional | 成功/失敗/ロック操作が監査ログに完全記録される    | §4.1      |        84 | High     | 監査要件/不正調査     | 任意            |                    | ログ整合/改ざん検知           | audit      |            |             |

**所感**: Abnormal/NonFunctional を含むが、セッション期限切れ再認証の記載が薄い。

---

### 8.2 例B: 受注登録→在庫引当→出荷

**入力要約**: 受注は承認後に在庫引当。在庫不足はバックオーダ。出荷確定で在庫減算し伝票発行。締日ロック中は出荷不可。

**出力（抜粋）**

| ViewpointID | Title   | TestCaseType      | Description              | SourceRef | RiskScore | RiskRank | RiskDetail  | Preconditions | DataNeeds | Observability | Tags     | Duplicates | Assumptions |
| ----------- | ------- | ------------- | ------------------------ | --------- | --------: | -------- | ----------- | ------------- | --------- | ------------- | -------- | ---------- | ----------- |
| VP-ORD-01   | 承認後のみ引当 | Quasi         | ステータス=承認後にのみ在庫引当が可能      | §3.2      |        76 | High     | 誤引当で二重出荷リスク | 受注=承認         | SKU, qty  | DB状態/業務ログ     | workflow |            |             |
| VP-ORD-02   | 在庫不足のBO | Abnormal      | 在庫不足時はバックオーダに遷移し通知される    | §3.3      |        90 | High     | 欠品は顧客影響大    | 受注=承認         | 在庫<需要     | 状態遷移/通知ログ     | stock    |            |             |
| VP-ORD-03   | 締日ロック   | Abnormal      | 締処理中は出荷確定がブロックされる        | §5.1      |        80 | High     | 会計影響/不整合    | 締処理=実行中       | 売上日=月末    | UIエラー/監査ログ    | closing  |            |             |
| VP-ORD-04   | 伝票/監査   | NonFunctional | 出荷確定で伝票発行・改ざん防止番号・監査項目記録 | §4.4      |        72 | Medium   | 監査/税務要件     | 出荷確定可能        |           | 伝票PDF/監査ログ    | audit    |            |             |

**所感**: 在庫予約の同時更新/ロック競合の扱いは追加検討が必要。

---

## 9. プロンプト指示テンプレート（LLMに渡すテキスト）

```text
あなたはソフトウェア品質のテストアナリストだ。以下のドキュメントからテスト観点を抽出し、Markdownで出力する。

【入力】
- 元ドキュメント: <タイトル/版/日付/範囲/抜粋>
- 補助資料（任意）: <画面遷移/ER/API 等>
- チームの重点観点（任意）: <例: 境界値・権限・監査>

【要件】
1) 各観点に TestCaseType を `Normal | Quasi | Abnormal | NonFunctional` で必ず付与。
2) 各観点に SourceRef（節/表/図/API/行）を必ず付与。無い場合は「提案」と明示。
3) Observability（UI/ログ/DB/API/メトリクス）と DataNeeds（権限/日時/桁数等）を記述。
4) §4の式で RiskScore(0–100) を算出し、RiskRank を High/Medium/Low のいずれかで付与。
5) 重複/包含は統合し、Duplicates に関連 ID を列挙。
6) 曖昧/仕様外は Assumptions に仮定として記録。
7) 最後に Normal/Quasi/Abnormal/NonFunctional の件数比と盲点を要約。

【出力】
- §6のMarkdownテンプレートに厳密に従うこと。
- 表示順は RiskRank=High → Medium → Low、同率は SourceRef の順。
- 1観点は 1–3 文の簡潔説明にとどめる。
```

---

## 10. 品質チェックリスト（自己検査）

* [ ] すべての観点に `TestCaseType` と `SourceRef` が付与されている。
* [ ] Normal/Quasi/Abnormal/NonFunctional の**比率が偏りすぎていない**。
* [ ] 高リスク領域に観測点が定義されている（UI/ログ/DB/API）。
* [ ] 権限/境界/状態遷移/外部連携/締処理/監査の観点が存在。
* [ ] 重複や包含が整理され、ID 参照が整合している。
* [ ] 所感に盲点/留意が記録され、次工程で使える。

---

## 11. ノート

* 本ガイドは `rules.md` と併用し、抽出結果は `test_review_guide.md` の観点↔ケース照合に直結する。
* リスク評価のルーブリック（§4）は本ガイドで定義。スコアリング基準や総合評価ランクは `rules.md` §3, §4 を参照。
* 数式/尺度はチームで調整可。変更時は版数を更新し、偏りのトレンドをレビュー会で共有する。
