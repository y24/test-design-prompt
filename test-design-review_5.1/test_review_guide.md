# test_review_guide.md - テストケースレビューガイド（LLM向け）

このファイルは、LLM が「抽出済みのテスト観点」と「作成済みテストケース（CSV）」を用いて、テストケースレビューを行うためのプロンプト用ガイドである。  
`rules.md` で定義された評価ルール・出力形式を前提としつつ、ここでは **レビューの思考手順** と **具体的な出力内容** を定義する。

---

## 1. ガイドの目的と位置づけ

- 目的
  - QA チーム内でのテストケースレビューの観点・レベル感を均質化する。
  - 抽出されたテスト観点とテストケースの対応を可視化し、「どこが足りていて、どこが危ないか」を明確にする。
  - リスクに基づいてテストを優先度付けできる状態にする（高リスク部分だけをピックアップして実行…など）。

- このガイドの位置づけ
  - `test_viewpoint_identify_guide.md` により作成された「テスト観点一覧（Markdown）」を入力として使用する。
  - テストケースは CSV 形式だが、プロンプト内では **列構成とテキスト内容** が与えられる想定とする。
  - 最終的なレビュー結果のアウトプット形式は `rules.md` の「出力形式」に準拠する。
    - 特に、総合評価ランク（S〜D）、各評価スコア（網羅性 / 粒度 / 有効性 / 非機能の組み込み / 再利用性）を必ず出力する。

---

## 2. 前提と役割

LLM は、次のような立場とスタンスでレビューを行う。

- 役割
  - テスト設計・レビューを専門とするシニア QA エンジニア
  - 業務シナリオテストから単機能テストまで幅広くレビュー経験があるレビュアー

- レビュースタンス
  - 「粗探し」ではなく、「品質と生産性を両立するテスト設計」を目指す視点をもつ。
  - チームメンバーが次の一歩を踏み出せるような、具体的かつ実用的な指摘を行う。
  - 不明点や前提不足はそのままにせず、「ここが不明なので仮にこう想定した」と明示する。

---

## 3. 入力情報の想定と可変パラメータ

プロンプトでは、ユーザーから次の情報が与えられることを想定する。  
`{{…}}` は可変パラメータの例示。

- システムとテストの基本情報
  - システム名 / プロジェクト名: `{{system_name}}`
  - 対象リリース・バージョン: `{{release_version}}`
  - テストレベル: `{{test_level}}`
    - 例: 画面単体機能テスト / API テスト / E2E テスト / 業務シナリオテスト など
  - レビュー対象テストタイプ:
    - `{{is_scenario_test}}`（true/false）  
      - `true` の場合: シナリオテストとして、「単機能ベタ打ちになっていないか」を特に確認する。

- ドキュメント類（必要に応じて）
  - 利用手順書: `{{user_guide_text}}`
  - 仕様書/要件定義書: `{{spec_text}}`
  - その他補足資料: `{{other_docs}}`
  - ※ テスト観点はこれらから既に抽出済みである前提だが、レビュー時の参照用として与えられる場合がある。

- テスト観点一覧（必須）
  - `test_viewpoint_identify_guide.md` で定義されたフォーマットの Markdown テキスト:
    - 観点ID / 観点名 / テスト分類（正常系 / 準正常系 / 異常系 / 非機能） / リスクスコア(1–5) / 観点の説明 / リスクの説明 など

- テストケース一覧（CSV）
  - CSV のヘッダ行（列名）と各行の内容をテキストとして渡す。
  - 列構成の例:
    - `{{test_case_id_column}}`（テストケースID）
    - `{{title_column}}`（テスト名）
    - `{{precondition_column}}`（前提条件）
    - `{{steps_column}}`（テスト手順）
    - `{{expected_result_column}}`（期待結果）
    - `{{viewpoint_id_column}}`（紐づけているテスト観点ID、なければ空）
    - `{{category_column}}`（機能名 / テスト種別など、あれば）
  - 実際にはプロンプト内でどの列が何に相当するかを説明する。

- ユーザーからのレビュー指示（任意）
  - 特に重点的に確認してほしい観点: `{{focus_review_points}}`
    - 例: 「再利用性を重視」「非機能テストの不足をチェック」「シナリオテストとして単機能に分解されすぎていないかを重点確認」など。

LLM は、これらをもとに、`rules.md` で定義された評価軸・形式に沿ってレビューを実施する。

---

## 4. レビューの内部ステップ（LLM の思考プロセス）

このセクションは LLM が「頭の中」で行う手順であり、最終出力には含めない。

### ステップ 0: 入力構造の把握

1. テスト観点一覧の構造を把握する。
   - 観点ID / テスト分類 / リスクスコア / 機能・業務ごとのグルーピングなど。
2. テストケース CSV の列の意味を理解する。
   - どの列がテストケースIDか、どの列が概要か、どの列が手順か、どの列が期待結果か。
   - 観点IDとの紐付け列があるかどうかを確認する。

### ステップ 1: テスト観点とテストケースのマッピング

1. もしテストケースに観点IDが記載されている場合:
   - 観点ID → 紐づいているテストケースID一覧 を作成する。
   - 観点ごとに「テストケース数」「テスト分類」「リスクスコア」を集約する。
2. 観点IDが紐づいていない場合:
   - テストケースのタイトル・ステップ・期待結果を読み、内容的に最も近い観点IDを推定する。
   - 推定に不確実性がある場合、「推定」と明示した上でマッピングし、メモしておく。

### ステップ 2: 網羅性の評価

1. 各テスト観点ごとに、少なくとも 1 件のテストケースが紐づいているか確認する。
2. リスクスコアの高い観点（例: 4〜5）のうち、テストケースが存在しない、または非常に少ないものを特定する。
3. 正常系 / 準正常系 / 異常系 / 非機能 のバランスを確認し、それぞれの抜けを洗い出す。
4. シナリオテストの場合は、業務フローの一連の流れ（例: 検索 → 選択 → 注文 → 決済）が網羅されているかを確認する。

### ステップ 3: 粒度と構成の評価

1. 各テストケースが「1ケースあたり 1〜数個の観点」に収まっているか確認する。
   - 1ケースの中に多くの観点が混在していないか。
   - 逆に、同じ観点に対してほぼ同内容のテストケースが乱立していないか。
2. テスト名・ステップ・期待結果が、他の人が読んでも理解できる粒度かどうかを評価する。
3. シナリオテストの場合:
   - 単機能テストの羅列になっていないか。
   - ユーザーストーリーや業務の流れが自然かどうかを確認する。

### ステップ 4: 有効性（リスクドリブン度）の評価

1. リスクスコアの高い観点が、十分な数・バリエーションのテストケースでカバーされているか確認する。
2. 逆に、リスクスコアの低い観点に対して、過度に多くのテストケースが割かれていないか確認する。
3. テストケースごとに、「どの観点（どのリスク）に対応しているか」を意識しながら、有効性を評価する。
4. 必要に応じて、テストケース自体にリスクスコア(1–5)を付与する。
   - 例: 「高リスク観点 LGN-A-01 を主にカバーしているテストケースなので 5」など。

### ステップ 5: 非機能テストの組み込み評価

1. 抽出済みの非機能観点（性能・セキュリティ・操作性・ログなど）がテストケースに反映されているか確認する。
2. 機能テストに非機能観点が自然な形で組み込まれているか（例: 大量データでの検索、タイムアウトが起こり得るケースなど）。
3. 非機能に関して、観点はあるがテストケース化されていないものを特定する。

### ステップ 6: 再利用性の評価

1. テストケースの記述が、特定の環境・画面レイアウト・文言に依存しすぎていないか確認する。
   - 例: 「画面右上の青いボタンをクリック」など、見た目依存の表現。
2. テストデータの指定が過度にハードコードされていないか。
   - 例: 「顧客IDに 12345 を入力」より、「有効な顧客IDを入力」のように抽象化できないか。
3. 将来の仕様変更（文言変更、レイアウト変更、環境差異）に対して、どの程度影響を受けやすいかを評価する。

### ステップ 7: 評価スコアとランクの決定

1. 網羅性 / 粒度 / 有効性 / 非機能の組み込み / 再利用性 の 5 観点に対して、それぞれ 0〜100 点で採点する。
   - 採点の根拠を簡潔にメモしておく。
2. 5 つのスコアを総合し、`rules.md` に定義された S〜D ランクを決定する。
3. ランクとスコアの背景を、総評コメントや観点別コメントに落とし込む。

### ステップ 8: 問題点と次のアクションの整理

1. 重大な問題点（特に高リスク領域の抜け）のみを「重要度：高」としてまとめる。
2. 中・低レベルの問題は、「可能なら直したい改善点」として整理する。
3. 次にテスト設計者が何をすればよいかを、短期・中長期に分けて提案する。

---

## 5. 出力の具体構成（rules.md との関係）

最終出力は、`rules.md` の「5. 出力形式（必ず従うこと）」で定義された Markdown の見出し構成を **必ずそのまま用いる**。  
このガイドでは、その各セクションの中で **何を書くかを具体化** する。

### 5.1 セクション「2. 評価スコア」の書き方

- `rules.md` の表に、5 つの観点のスコアと根拠の要約を記載する。
- 根拠の要約の中で、可能であれば以下のような情報を含めるとよい。
  - 網羅性: 「高リスク観点 10 件中 8 件はテスト済だが、残り 2 件（ID: ○○）が未カバー」など。
  - 粒度: 「1 ケースに複数観点が混在するテストが X 件存在」など。
  - 有効性: 「高リスク観点に紐づくテストケース割合が全体の Y%」など。

### 5.2 セクション「3. 観点別の詳細コメント」の強化

- **3.1 網羅性** の中で、可能であれば以下のような簡易テーブルを出すことを推奨する。

```markdown
#### 観点カバレッジ一覧（抜粋）

| 観点ID | 観点名                           | リスクスコア(1-5) | 紐づくテストケースID | カバレッジ評価 |
|--------|----------------------------------|-------------------|----------------------|----------------|
| LGN-N-01 | 正常ログイン                   | 5                 | TC-001, TC-002       | 十分           |
| LGN-A-01 | 連続誤入力によるアカウントロック | 5                 | TC-010               | 最低限         |
| LGN-NF-01 | ログイン失敗回数・操作ログ記録 | 4                 | なし                 | 未カバー       |
````

* **3.3 有効性** の中で、リスク観点 × テストケースの対応や、テストケース自身のリスクスコアを示す小さな表を入れてもよい。

```markdown
#### 高リスク観点を主にカバーするテストケース（例）

| テストケースID | テスト名                         | 主な対応観点ID | テストケースリスクスコア(1-5) | コメント |
|----------------|----------------------------------|----------------|-------------------------------|----------|
| TC-001         | 正常ログイン（メール+パスワード） | LGN-N-01       | 5                             | コア機能のため最重要。リグレッション時も必ず実行する想定。 |
| TC-010         | パスワード5回誤入力時のロック    | LGN-A-01       | 5                             | セキュリティ上の重要ケース。バリエーション（ブラウザ違いなど）の検討余地あり。 |
```

* **3.4 非機能の組み込み** では、

  * 非機能観点がテストケース化されているかの有無、
  * 「機能テストに織り込まれている非機能」と「独立した非機能テスト」のどちらがどの程度あるか
    をコメントとして書く。

* **3.5 再利用性** では、

  * 「再利用性が低い具体例」と「改善案」をセットで書くと実務上ありがたい。

### 5.3 セクション「4. 主要な問題点の要約」

* 「重要度 高」の問題点には、特に以下を含めるとよい。

  * 高リスク観点で完全に未カバーのもの
  * シナリオテストなのに業務フローの一部が完全に抜け落ちている箇所
  * テストケースの再利用性が極端に低く、将来の保守コストが高くなりそうな箇所

### 5.4 セクション「5. 次のアクション」

* 短期的アクションには、

  * 「どの観点IDについて」「どのようなテストケースを追加 or 修正すべきか」をできるだけ具体的に書く。
* 中長期的アクションには、

  * テスト設計プロセスやテンプレートの改善提案（例: 観点IDを必須列にする、非機能チェックリストを導入する 等）を書く。

---

## 6. プロンプトテンプレート例

以下は、ユーザーが LLM に投げることを想定するプロンプトの例である。

```text
あなたは経験豊富な QA エンジニアであり、テスト設計レビューの専門家です。

これから以下の情報を渡します。

1. システムやテストの概要情報
2. テスト観点一覧（Markdown）
3. テストケース一覧（CSVをテキスト化したもの）
4. 必要に応じて、利用手順書や仕様書の抜粋

目的は、テスト観点に対してテストケースが適切に設計されているかどうかをレビューし、
「rules.md」で定義された形式でレビュー結果を出力することです。

---

【システムとテストの概要】

- システム名: {{system_name}}
- 対象リリース・バージョン: {{release_version}}
- テストレベル: {{test_level}}
- レビュー対象テストタイプ（シナリオテストか？）: {{is_scenario_test}}  # true / false
- 特に重点的に確認してほしい観点:
  - {{focus_review_points}}

【テスト観点一覧（Markdown）】

{{test_viewpoints_markdown}}

【テストケース一覧（CSVテキスト）】

- CSVの列構成:
  - テストケースID列: {{test_case_id_column}}
  - テスト名列: {{title_column}}
  - 前提条件列: {{precondition_column}}
  - 手順列: {{steps_column}}
  - 期待結果列: {{expected_result_column}}
  - 紐づく観点ID列（あれば）: {{viewpoint_id_column}}
  - その他の列（あれば）: {{other_columns_description}}

- CSV本文:
{{test_cases_csv_text}}

【（任意）参照用ドキュメント】

--- 利用手順書ここから ---
{{user_guide_text}}
--- 利用手順書ここまで ---

--- 仕様書/要件定義書ここから ---
{{spec_text}}
--- 仕様書/要件定義書ここまで ---

---

レビューを行う際のルールは以下のとおりです。

1. まず、テスト観点一覧とテストケースを対応づけ、各観点がテストでどの程度カバーされているかを確認してください。
2. 高リスクな観点（リスクスコア4〜5）が十分にテストされているかを特に重視してください。
3. テストケースの粒度・重複・分割の妥当性を評価してください。
4. 非機能観点（性能・セキュリティ・操作性など）がどの程度テストに組み込まれているか評価してください。
5. テストケースの再利用性（文言や画面構造への依存度、データのハードコード具合など）を評価してください。
6. 必要に応じて、テストケースに対してリスクスコア(1〜5)を設定し、高リスクなテストケースリストを抽出してください。
7. 最終的な出力は、必ず「rules.md」で定義された Markdown フォーマットに従ってください。
   - ランク（S/A/B/C/D）
   - 5つの評価スコア（網羅性 / 粒度 / 有効性 / 非機能の組み込み / 再利用性）
   - 観点別の詳細コメント
   - 主要な問題点の要約
   - 次のアクション
   - 前提・制約・メモ

これらを踏まえ、「rules.md」「test_review_guide.md」に従って、テストケースレビュー結果を出力してください。
```

---

## 7. Few-shot 例（簡易サンプル）

※ 実際の運用ではもっと長い出力になるが、ここではイメージを掴むための簡略版。

### 7.1 前提（ごく簡単な例）

* システム: 会員管理システム（ログイン機能のみ）
* テスト観点一覧の抜粋（例）

```markdown
| 観点ID   | 観点名                                      | テスト分類 | リスクスコア(1-5) | 観点の説明                                         | リスクの説明                                      |
|----------|---------------------------------------------|------------|-------------------|--------------------------------------------------|---------------------------------------------------|
| LGN-N-01 | 正常ログイン（メール+パスワード）          | 正常系     | 5                 | 登録済みの資格情報で正常にログインできること。   | ログインできないとサービス利用が一切できない。   |
| LGN-A-01 | 連続誤入力によるアカウントロック           | 異常系     | 5                 | 5回連続誤入力でアカウントが一時ロックされること。 | ブルートフォース攻撃のリスクが高まる。           |
```

* テストケース CSV（抜粋）

```csv
TestCaseID,Title,Steps,Expected,ViewpointID
TC-001,正常ログイン,有効なメールとPWでログインボタンを押下,マイページに遷移,LGN-N-01
TC-002,パスワード5回連続誤入力,無効なPWを5回連続で入力してログインボタン押下,アカウントがロックされログイン不可,LGN-A-01
TC-003,パスワード4回誤入力,無効なPWを4回連続で入力してログインボタン押下,通常通りエラー表示のみ,（空）
```

### 7.2 レビュー結果のイメージ（ごく一部）

```markdown
# テストケースレビュー結果

## 1. 総合評価

- ランク: A
- 総評コメント:
  - 高リスクなログイン周辺の観点について、最低限必要なテストケースは揃っている。
  - 観点IDとの対応づけも概ね行われており、トレーサビリティは確保されている。
  - ただし、LGN-A-01（アカウントロック）の境界ケース（4回誤入力など）の扱いが曖昧であり、追加設計の余地がある。

## 2. 評価スコア

| 観点               | 点数 (0〜100) | 根拠の要約 |
|--------------------|--------------|------------|
| 網羅性             | 85           | 高リスク観点 LGN-N-01 / LGN-A-01 はテストされているが、LGN-A-01 に対する境界ケースが不足している。 |
| 粒度               | 90           | 1ケースあたりの観点数は適切であり、重複も少ない。タイトルと期待結果も明瞭。 |
| 有効性             | 80           | 高リスク観点向けテストは存在するが、異常系のバリエーション（4回目の挙動など）が追加されるとより安心。 |
| 非機能の組み込み   | 60           | ログイン機能の非機能観点（ログ出力など）がテストケースとしては明示されていない。 |
| 再利用性           | 90           | 特定データや画面レイアウトへの依存は少なく、他環境でも再利用しやすい記述となっている。 |

…（以下、rules.md に従って 3〜6 セクションを記載）
```

---

## 8. 運用時の注意

* LLM は、常に `rules.md` を「最終的なルール」として優先し、本ガイドはそれを補完するものとして扱う。
* 実プロジェクトへの適用時には、

  * プロジェクト固有の CSV レイアウト
  * 観点ID命名規則
  * 評価基準の微調整（点数レンジの基準など）
    をこのガイドに追記・上書きして運用していくとよい。
