# test_scenario_design_guide.md - 業務シナリオ設計ガイド（テスト観点 → シナリオ束ね）

---

## 1. このガイドの目的

このガイドは、`rules.md` および `test_viewpoint_identify_guide.md` に従って抽出された  
**テスト観点一覧** を入力として、業務の流れやユーザーストーリーを意識した  
**業務シナリオテスト** を設計するためのプロンプトテンプレートを示す。

ここでいう **業務シナリオ** とは、実際のユーザーや担当者が行う業務の流れに沿った

- 一連の画面遷移・操作
- それに伴うステータス変化やデータ更新
- 関係者（申請者／承認者／管理者など）の役割分担

をまとめたテストの単位を指す。

目的は、**単機能テストの羅列ではなく「業務のストーリー」としてテストを設計すること**。  
さらに、各シナリオに **リスクスコアや優先度** を付与し、  
限られた工数でも効果的にテストを実施できるようにする。

---

## 2. 役割と前提

あなた（LLM）は、業務システムのテスト設計に精通した  
**テストアナリスト／QAエンジニア** として振る舞う。

- すでに抽出済みの **テスト観点一覧**（viewpoint_id 単位）を入力として受け取り、  
  それらを適切に束ねた **業務シナリオ** を設計する。
- シナリオは「ユーザーの業務目的」を中心に構成し、  
  画面単位や API 単位をただ並べるだけの構造は避ける。
- テスト観点を無理にすべて 1 本のシナリオに詰め込むのではなく、  
  **業務上意味のある単位に分割**する。
- ただし、単機能テストレベルの非常に細かいシナリオを大量に生成することは避ける。

このファイルは、`rules.md` と `test_viewpoint_identify_guide.md` に  
**すでに準拠している前提** で利用される。

---

## 3. 入力として与えられる情報

業務シナリオ設計にあたり、ユーザーからは少なくとも以下の情報が与えられる。

1. **テスト観点一覧（必須）**
   - `viewpoint_id, category, sub_category, viewpoint_title, viewpoint_detail, test_classification, risk_score, risk_reason, source_reference, notes`  
   などの列を含む Markdown テーブル。

2. **システム・業務の概要（任意）**
   - システム名（`SYSTEM_NAME`）
   - 業務ドメイン（`DOMAIN`）
   - 想定利用者（例：一般社員、管理者、経理担当、上長 など）

3. **テストの制約情報（任意）**
   - テスト対象範囲 `TEST_SCOPE`
   - テスト対象外範囲 `OUT_OF_SCOPE`
   - 特に重視したいリスクレベル `RISK_FOCUS_LEVEL`  
     （例：3以上、4以上 など）
   - 想定するシナリオ本数の目安 `SCENARIO_COUNT_HINT`

これらが与えられている場合、  
**シナリオの粒度・カバレッジ・優先度の設計に積極的に反映すること。**

---

## 4. 業務シナリオの設計方針

### 4.1 シナリオの粒度

業務シナリオは、次のような単位を 1 本として扱うことを基本とする。

- 「ログイン → 〇〇検索 → 詳細表示 → 更新 → ログアウト」のような  
  **1 人の役割が完結する一連の業務フロー**
- 「申請者が申請 → 承認者が承認 → 後続処理が可能になる」のような  
  **複数ロールが関与する重要なフロー**
- 「インポート → 検証 → エラー行修正 → 再インポート」のような  
  **エラーを含む現実的な運用ケース**

極端に細かいテスト（例：「必須項目エラーだけを確認するシナリオ」）は、  
観点レベルで管理し、シナリオではなるべく **実務に近い文脈** を保つ。

### 4.2 観点との関係

各シナリオは 1 つ以上の `viewpoint_id` をカバーする。

- `related_viewpoints` 列に、カバーする `viewpoint_id` を **カンマ区切り** で記載する。
- 1 つの観点が複数シナリオでカバーされる場合もあり得るが、  
  原則として「主に確認するシナリオ」を 1 つ決めると管理しやすい。
- 逆に、どのシナリオにも含まれていない観点がある場合、  
  その旨をコメントし、必要に応じてシナリオ追加を提案する。

### 4.3 リスクと優先度

- シナリオの `scenario_risk_score` は、関連する `viewpoint_id` の `risk_score` を参考に決める。
  - 単純に最大値を取る、または重み付きで少し調整してもよい。
- `priority` は `Must / Should / Could` の 3 段階とする。
  - `Must` : リリース前に必ず実施すべきクリティカルシナリオ
  - `Should` : 時間が許す限り実施したい重要シナリオ
  - `Could` : 余裕があれば実施する追加的なシナリオ

`RISK_FOCUS_LEVEL` が指定されている場合は、  
そのレベル以上の観点をできるだけ `Must` シナリオに取り込むことを意識する。

---

## 5. 出力フォーマット（必須）

業務シナリオは、次の列を持つ **Markdown テーブル** として出力する。

- `scenario_id`
- `scenario_title`
- `business_goal`
- `related_viewpoints`
- `preconditions`
- `main_flow`
- `alternative_flow`
- `expected_result`
- `scenario_risk_score`
- `priority`
- `test_type`
- `notes`

テーブルヘッダの例：

```markdown
| scenario_id | scenario_title | business_goal | related_viewpoints | preconditions | main_flow | alternative_flow | expected_result | scenario_risk_score | priority | test_type | notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
````

### 各列の説明

* `scenario_id`

  * シナリオを一意に識別する ID。例：`SC-001`, `SC-002` …

* `scenario_title`

  * シナリオの概要が一目でわかる短い名前。
  * 例：「通常ログインとトップ画面表示」「受注登録〜承認フロー（正常）」など。

* `business_goal`

  * シナリオが達成すべき **業務上の目的** を記載する。
  * 例：「営業担当者が新規受注を登録し、承認まで完了させる」など。

* `related_viewpoints`

  * このシナリオでカバーする `viewpoint_id` をカンマ区切りで列挙する。
  * 例：`VP-001, VP-002, VP-003`

* `preconditions`

  * シナリオを開始する前に満たしておくべき条件。
  * 例：ログイン済みである、特定のユーザーが承認権限を持つ、テストデータが登録済み など。
  * 箇条書き形式のテキストでもよい（Markdown の `-` を使ってもよい）。

* `main_flow`

  * シナリオの **メインの操作フロー** を、ステップ番号付きで簡潔に記載する。
  * 例：`1. 〜画面を開く / 2. 〜を入力する / 3. 〜ボタンを押下する / ...`
  * 5〜10 ステップ程度を目安にする。

* `alternative_flow`

  * メインフローから分岐する処理（エラー分岐、条件による別ルートなど）がある場合に記載する。
  * 複数ある場合は、`(A)`, `(B)` のようにラベルを付けてもよい。
  * ない場合は空欄でもよい。

* `expected_result`

  * シナリオ全体として期待される結果・状態を記載する。
  * 画面表示結果だけでなく、ステータス、DBへの登録内容、後続処理の可否などを含める。

* `scenario_risk_score`

  * このシナリオがカバーする観点の中で、**最大またはそれに準じるリスクレベル** を 1〜5 で表す。
  * 必要なら `notes` や別途コメントで、どう算出したかを記載してもよい。

* `priority`

  * `Must / Should / Could` のいずれかを指定する。

* `test_type`

  * シナリオの性質を表すラベル。例：

    * `エンドツーエンド`
    * `単一業務フロー`
    * `クロス機能（複数機能の連携）`
    * `例外処理重視`
    * `権限・セキュリティ`
      など。

* `notes`

  * テストデータの注意点、環境依存事項、未確定の仕様などを記載する。

---

## 6. プロンプト雛形（LLMに渡すときの形）

### 6.1 SYSTEM メッセージ（例）

```text
あなたは業務システムの業務シナリオテストを設計するテストアナリストです。

すでに抽出されたテスト観点一覧（viewpoint_id 単位）をもとに、
実際の業務フローやユーザーストーリーを意識した「業務シナリオ」を設計してください。

各シナリオは、複数のテスト観点を適切に束ねたものとし、
単機能テストの羅列ではなく、業務上意味のある一連の流れとなるようにしてください。

各シナリオごとに、以下の情報を Markdown テーブル形式で出力してください：
- scenario_id, scenario_title, business_goal, related_viewpoints,
  preconditions, main_flow, alternative_flow, expected_result,
  scenario_risk_score, priority, test_type, notes

テスト観点ごとの risk_score を参考に、scenario_risk_score と priority を設定してください。
```

### 6.2 USER メッセージ雛形（例）

```text
以下の情報をもとに、業務シナリオテストのシナリオを設計してください。

# システム情報
- システム名: {{SYSTEM_NAME}}
- 業務ドメイン: {{DOMAIN}}
- テスト対象範囲: {{TEST_SCOPE}}
- テスト対象外範囲: {{OUT_OF_SCOPE}}
- 特に重点的に確認したいリスクレベル: {{RISK_FOCUS_LEVEL}}
- 想定するシナリオ本数の目安: {{SCENARIO_COUNT_HINT}}  （例: 10〜15 本程度）

# テスト観点一覧
以下に、事前に抽出済みのテスト観点一覧（Markdown テーブル）を貼り付けます。
この一覧の viewpoint_id を必ず参照しながらシナリオを設計してください。

{{VIEWPOINT_TABLE}}

# 要求事項
1. 業務プロセスやユーザーストーリー単位で、業務シナリオを設計してください。
2. 1 本のシナリオには、複数の関連するテスト観点（viewpoint_id）を紐づけてください。
3. 各シナリオは、以下の列を持つ Markdown テーブル形式で出力してください。
   - scenario_id, scenario_title, business_goal, related_viewpoints,
     preconditions, main_flow, alternative_flow, expected_result,
     scenario_risk_score, priority, test_type, notes
4. scenario_risk_score は、関連するテスト観点の risk_score を参考に 1〜5 で設定してください。
5. priority は Must / Should / Could のいずれかで設定し、
   特にリスクの高い観点を含むシナリオは Must として優先的に実施できるようにしてください。
6. main_flow は、業務の流れが追える程度にステップ番号つきで記載してください。
7. alternative_flow がない場合は空欄で構いません。
8. 出力は、業務シナリオ一覧の Markdown テーブルのみを出力してください。説明文や前置きは不要です。
```

`{{...}}` はユーザーが差し込む可変部分。

---

## 7. Few-shot 例1：ログイン〜トップ画面確認シナリオ

### 7.1 前提（観点の例）

`test_viewpoint_identify_guide.md` の例と同様に、ログイン機能で以下の観点があるとする：

* `VP-001` ログイン正常
* `VP-002` 間違ったパスワード時のエラーメッセージ
* `VP-003` 一定回数失敗時のアカウントロック
* `VP-004` ロックされたアカウントでのログイン拒否

### 7.2 期待されるシナリオ例（Markdown テーブル）

```markdown
| scenario_id | scenario_title | business_goal | related_viewpoints | preconditions | main_flow | alternative_flow | expected_result | scenario_risk_score | priority | test_type | notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| SC-001 | 通常ログインとトップ画面表示 | 正しい資格情報でログインし、トップ画面が表示されることを確認する。 | VP-001 | - 対象ユーザーが有効なアカウントを持っていること<br>- アカウントがロックされていないこと | 1. ログイン画面を表示する。<br>2. 正しいユーザーIDとパスワードを入力する。<br>3. 「ログイン」ボタンを押下する。<br>4. トップ画面（メインメニュー）が表示されることを確認する。 | なし | 正しい資格情報でログインした場合に、エラーメッセージが表示されず、トップ画面が表示され、ログイン状態が維持される。 | 5 | Must | エンドツーエンド | 代表的な正常シナリオ。以降の業務シナリオの前提になるため必須。 |
| SC-002 | 間違ったパスワード時のエラー表示 | 誤ったパスワード入力時に適切なエラーが表示され、ログインできないことを確認する。 | VP-002 | - 対象ユーザーが有効なアカウントを持っていること<br>- アカウントがロックされていないこと | 1. ログイン画面を表示する。<br>2. 正しいユーザーIDと誤ったパスワードを入力する。<br>3. 「ログイン」ボタンを押下する。 | (A) 連続で2回以上誤ったパスワードでログインを試行する場合、その都度同じエラーメッセージと挙動になることを確認する。 | 指定のエラーメッセージ（例：「ユーザーID またはパスワードが違います」）が表示され、画面がログイン画面のままである。ログイン状態にはならない。 | 4 | Should | 単一業務フロー | 回数制限やアカウントロック観点とは別シナリオで扱う。 |
| SC-003 | アカウントロックとロック後のログイン拒否 | 一定回数のログイン失敗でアカウントがロックされ、その後ログインできないことを確認する。 | VP-003, VP-004 | - 対象ユーザーが有効なアカウントを持っていること<br>- 初期状態でロックされていないこと | 1. ログイン画面を表示する。<br>2. 対象ユーザーIDと誤ったパスワードを入力し、ログインを試行する。<br>3. ステップ2を規定回数（例：5回）繰り返す。<br>4. 規定回数到達後、アカウントがロックされたことを確認する（メッセージや管理画面など）。<br>5. ロックされた状態で正しいユーザーIDとパスワードでログインを試行する。 | (A) ロック状態でのログイン試行時に、ロック専用のエラーメッセージが表示される場合、その内容も確認する。 | 規定回数のログイン失敗後、アカウントがロックされ、それ以降は正しい資格情報でもログインできず、指定されたエラーメッセージが表示される。 | 5 | Must | 例外処理重視 / セキュリティ | 実際のロック解除手順は別シナリオで扱う。ロック回数は仕様書に依存するため notes で前提を明記。 |
```

このように、**複数観点を 1 本のシナリオに束ねつつも、業務上意味のある単位で区切る**。

---

## 8. Few-shot 例2：受注登録〜承認シナリオ

### 8.1 前提（観点の例）

`test_viewpoint_identify_guide.md` の例で、以下の観点があるとする：

* `VP-101` 必須項目を正しく入力した受注伝票の登録（正常登録）
* `VP-102` 数量・単価の異常値入力時のエラー処理（準正常系）
* `VP-103` 申請中伝票の承認（正常承認）
* `VP-104` 非承認者による承認操作の制御（権限）

### 8.2 期待されるシナリオ例（Markdown テーブル）

```markdown
| scenario_id | scenario_title | business_goal | related_viewpoints | preconditions | main_flow | alternative_flow | expected_result | scenario_risk_score | priority | test_type | notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| SC-101 | 受注登録〜承認フロー（正常） | 営業担当が受注を登録し、上長による承認までを一連の流れとして確認する。 | VP-101, VP-103 | - 営業担当ユーザーがログイン済みである。<br>- 上長ユーザーが承認権限を持つアカウントでログインできる。<br>- 必要なマスタ（顧客・商品など）が登録済みである。 | 1. 営業担当ユーザーで受注登録画面を開く。<br>2. 顧客・商品・数量・単価など必須項目を正しく入力する。<br>3. 受注伝票を保存し、ステータスが「入力中」であることを確認する。<br>4. ステータスを「申請中」に変更し、申請を実行する。<br>5. 上長ユーザーで承認画面にログインし、申請中の受注伝票を一覧から選択する。<br>6. 内容を確認し、「承認」ボタンを押下する。 | (A) 上長が内容に問題がある場合、「差戻し」機能がある場合は別シナリオとする。 | 正しく入力された受注伝票が登録され、申請・承認を経てステータスが「承認済」となり、出荷処理の対象として利用可能になる。 | 5 | Must | エンドツーエンド | 申請・承認の間にメール通知やワークフロー連携がある場合は、別途確認観点として扱う。 |
| SC-102 | 受注登録時の入力バリデーション確認 | 数量・単価などの異常値入力時に、適切なエラーメッセージが表示され、誤った受注が登録されないことを確認する。 | VP-102 | - 営業担当ユーザーがログイン済みである。 | 1. 受注登録画面を開く。<br>2. 顧客・商品などの基本情報を入力する。<br>3. 数量に 0 やマイナス値、極端に大きな値を入力する。<br>4. 伝票を保存しようとする。 | (A) 単価に許容範囲外の値を入力したパターンも同様に試行し、エラーメッセージと登録抑止を確認する。 | 異常値が入力された場合に仕様どおりのエラーメッセージが表示され、受注伝票が保存されない。既存データが不正な状態で登録されない。 | 4 | Should | 単一業務フロー / 例外処理重視 | 実際に許容される値の範囲は仕様書に依存するため、テストデータ設計時に確認が必要。 |
| SC-103 | 非承認者による承認操作制御 | 承認権限を持たないユーザーが承認操作を行えないことを確認する。 | VP-104 | - 一般ユーザーがログイン可能である。<br>- 一般ユーザーには承認権限が付与されていない。<br>- 申請中の受注伝票が1件以上存在する。 | 1. 承認権限を持たない一般ユーザーでログインする。<br>2. 承認画面または承認機能に相当する画面へのアクセスを試みる。<br>3. アクセスが拒否される、または対象メニューが表示されないことを確認する。<br>4. URL 直打ちなどで承認画面へ直接アクセスを試みる。 | (A) もし承認ボタン自体が表示される場合、押下時にエラーとなり処理が行われないことを確認する。 | 非承認者が承認機能にアクセスできない、または承認操作が実行できず、システムが権限逸脱を防止していることが確認できる。 | 5 | Must | 権限・セキュリティ | 役割ごとのメニュー表示制御や URL 直打ち対策など、実装方式に応じて確認内容を調整する。 |
```

---

## 9. 実運用上のチェックポイント

業務シナリオを設計したあと、次の点を自己レビューする。

1. **高リスク観点のカバレッジ**

   * risk_score が高い（例：4以上）の観点が、少なくとも 1 本以上のシナリオに紐づいているか。
   * 紐づいていない場合、その理由を明記し、必要であればシナリオを追加する。

2. **業務フローの自然さ**

   * シナリオが「実際の業務として自然な流れ」になっているか。
   * 不自然にテスト観点を詰め込みすぎていないか。
   * 逆に、観点を細かく分けすぎて、業務の文脈が失われていないか。

3. **シナリオの数と粒度**

   * `SCENARIO_COUNT_HINT` に対して、過不足ない本数になっているか。
   * 必要以上に似たシナリオを量産していないか。

4. **優先度とスコアの整合**

   * scenario_risk_score と priority の整合性が取れているか。
   * 明らかに高リスクなのに `Could` になっていないか。

---

## 10. まとめ

このガイドの役割は、抽出済みの **テスト観点** をただ並べるのではなく、

* 業務フローやユーザーストーリーを単位に束ねる
* リスクと優先度を明示する
* 現実的なテスト工数の中で、どのシナリオから実施すべきかを判断しやすくする

ための **「業務シナリオ設計の型」** を、LLMにインストールすることにある。

観点の世界から、少しだけ視点を引いて、
「現場で人がどう動くか」というストーリーを意識してシナリオを組み立てることで、
単なる網羅テストではなく、**リスクに強い業務シナリオテスト** が設計できるようになる。

このファイルは、`rules.md`・`test_viewpoint_identify_guide.md` とセットで運用することを前提とする。
