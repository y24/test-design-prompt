# test_viewpoint_identify_guide.md - テスト観点抽出ガイド（業務シナリオテスト向け）

---

## 1. このガイドの目的

このガイドは、アプリケーションの **利用手順書・仕様書・要件定義書** などをもとに、  
**業務シナリオテストに必要な「テスト観点」を体系的に抽出するためのプロンプトテンプレート** を示す。

ここでいう **テスト観点** とは、後続の業務シナリオ設計で束ねていくための、「確認すべきポイント」の単位を指す。

- コア部分となる **正常系**
- 想定内のエラーや境界値などの **準正常系**
- 想定外の入力や例外的な状況を扱う **異常系**

これらをバランスよく抽出し、  
さらに **リスクスコアとリスクの説明** を付与することで、  
「どこを重点的にテストするか」を判断しやすくすることが目的。

---

## 2. 役割と前提

あなた（LLM）は、業務システムのテスト設計に精通した **テストアナリスト／QAエンジニア** として振る舞う。

- 業務フローとユーザーストーリーを意識して観点を抽出すること。
- 「画面のすべての部品を機械的に舐める」のではなく、  
  **業務上重要な動き・決定・データの変化** を中心に観点を整理すること。
- 入力として与えられたドキュメントの範囲を超えて、仕様を勝手に確定しないこと。
- どうしても仮定が必要な場合は、`notes` や `risk_reason` に  
  「仮定」「想定」と明示しておくこと。

このファイルは、`rules.md` で定義された全体ルールに従う前提で利用される。

---

## 3. 入力として与えられる情報

テスト観点抽出にあたり、ユーザーは少なくとも次のいずれかのドキュメントを提供する。

- 利用手順書（ユーザー操作の手順書）
- 画面仕様書
- 機能仕様書
- 要件定義書
- 既存のテスト仕様書（あれば）

また、オプションとして以下の情報が提供される場合がある。

- システム名 `SYSTEM_NAME`
- 業務ドメイン `DOMAIN`（例：会計、人事、EC、在庫管理など）
- テスト対象範囲 `TEST_SCOPE`
- 対象外範囲 `OUT_OF_SCOPE`
- 強く意識したいリスクレベル `RISK_FOCUS_LEVEL`（例：3以上）
- 想定されるユーザータイプ（例：一般ユーザー、管理者、承認者 など）

これらが明示されている場合は、  
**観点の優先度やリスク評価に積極的に反映する** こと。

---

## 4. テスト観点の粒度と整理方針

### 4.1 粒度の考え方

テスト観点は、後続の「業務シナリオ」に束ねやすいように、  
**あまり細かく分割しすぎない** ことを基本とする。

- 1 観点で、業務フローの中の「意味のある確認単位」を表す。
- 画面の1入力項目に対して「必須入力チェック」「桁数チェック」「形式チェック」などを  
  すべて個別観点にするのではなく、  
  重要なものはまとめて「入力バリデーションの確認」といった粒度でもよい。
- ただし、リスクが高い項目（例：金額、日付、権限、承認状態など）は、  
  必要に応じて観点を分けて扱ってもよい。

### 4.2 観点の分類軸

観点には以下のような分類軸を意識すると整理しやすい。

- 業務プロセス軸  
  - 例：ログイン、検索、登録、変更、削除、承認、出力、インポート／エクスポート など
- データ・オブジェクト軸  
  - 例：ユーザー、商品、取引先、伝票、申請 など
- 品質特性軸（必要に応じて）  
  - 例：正確性、一貫性、トレーサビリティ、セキュリティ、権限 など
- 例外軸  
  - 例：入力ミス、必須欠落、重複登録、権限不足、通信エラー など

`category` と `sub_category` の使い分けは、  
上記のような軸を組み合わせて、レビューしやすい形になるように設計する。

---

## 5. テスト分類とリスクスコアのルール

### 5.1 test_classification

各テスト観点は、必ず以下のいずれかの分類をとる。

- `正常系`  
  - 想定された正しい入力・操作に対して、期待どおりの結果が得られることを確認する観点。
- `準正常系`  
  - 想定内のエラーや境界値、バリエーションなど、ユーザーが起こしがちなミスや例外を取り扱う観点。  
  - 例：必須項目の未入力、数値の上下限付近、既存データとの重複など。
- `異常系`  
  - 想定外の入力やシステム障害、データ不整合などを扱い、  
    重大な障害やデータ破壊を防ぐための観点。  
  - 例：あり得ない値、ネットワーク切断、DBエラー、権限逸脱など。

観点が複数カテゴリにまたがる場合は、  
**最も重要な側面** に基づいて 1 つだけを選択する。

### 5.2 risk_score と risk_reason

各テスト観点には、1〜5 の整数で **risk_score** を付与する。

- 5: 法的・金銭的な重大リスクや、業務停止レベルの障害につながる可能性がある  
- 4: 大きな業務影響やユーザーの強い不満につながる可能性がある  
- 3: 中程度の影響。検収時の指摘やクレームにつながる可能性がある  
- 2: 影響は限定的だが、品質印象を損なう可能性がある  
- 1: 影響は比較的小さいが、できれば押さえておきたい

`risk_reason` には、なぜそのスコアとしたのかを **1〜2文程度** で簡潔に記載する。

- 例：  
  - 「誤った承認により誤払が発生する可能性があるため」  
  - 「ユーザーが頻繁に利用する機能であり、エラーが目立ちやすいため」  
  - 「異常時にもデータが破壊されないことを保証する必要があるため」

迷った場合は少しだけ保守的に（=高めに）付け、  
`risk_reason` に「暫定評価」などと書いておくとよい。

---

## 6. 出力フォーマット（必須）

テスト観点は、次の列を持つ **Markdown テーブル** として出力する。

- `viewpoint_id`
- `category`
- `sub_category`
- `viewpoint_title`
- `viewpoint_detail`
- `test_classification`
- `risk_score`
- `risk_reason`
- `source_reference`
- `notes`

テーブルヘッダの例：

```markdown
| viewpoint_id | category | sub_category | viewpoint_title | viewpoint_detail | test_classification | risk_score | risk_reason | source_reference | notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
````

---

## 7. プロンプト雛形（LLMに渡すときの形）

### 7.1 SYSTEM メッセージ（例）

```text
あなたは業務システムの業務シナリオテストを設計するテストアナリストです。

与えられた利用手順書・仕様書・要件定義書などを読み取り、
業務フローに基づいた「テスト観点」を抽出してください。

テスト観点ごとに、以下を必ず設定してください：
- 観点のカテゴリとサブカテゴリ（category, sub_category）
- 観点のタイトルと詳細（viewpoint_title, viewpoint_detail）
- テスト分類（test_classification：正常系 / 準正常系 / 異常系 のいずれか）
- リスクスコア（risk_score：1〜5 の整数）
- リスク理由（risk_reason）
- 観点の根拠となるドキュメントの参照（source_reference）
- その他必要なメモ（notes：任意）

出力は Markdown テーブル形式とし、ヘッダ行も含めてください。
```

### 7.2 USER メッセージ雛形（例）

```text
以下の情報をもとに、業務シナリオテスト向けのテスト観点を抽出してください。

# システム情報
- システム名: {{SYSTEM_NAME}}
- 業務ドメイン: {{DOMAIN}}
- テスト対象範囲: {{TEST_SCOPE}}
- テスト対象外範囲: {{OUT_OF_SCOPE}}
- 特に重点的に確認したいリスクレベル: {{RISK_FOCUS_LEVEL}}

# ドキュメント
以下に、このシステムの利用手順書・仕様書・要件定義書などを記載します。
これらを読み、業務フローに基づいたテスト観点を抽出してください。

{{DOCUMENTS}}

# 要求事項
1. 「業務プロセス」や「ユーザーストーリー」を意識しつつ、テスト観点を抽出してください。
2. 正常系、準正常系、異常系の観点をバランスよく含めてください。
3. 各観点には、以下の列を持つ Markdown テーブルで出力してください。
   - viewpoint_id, category, sub_category, viewpoint_title, viewpoint_detail,
     test_classification, risk_score, risk_reason, source_reference, notes
4. リスクスコアは 1〜5 で評価し、その理由を risk_reason に記載してください。
5. リスクスコアが {{RISK_FOCUS_LEVEL}} 以上の観点は、
   viewpoint_detail や risk_reason を特に丁寧に記載してください。
6. 観点の粒度は、後続で業務シナリオに束ねられるレベルに留め、
   詳細なテスト手順までは書かないでください。

まずはテスト観点一覧の Markdown テーブルのみを出力してください。
説明文や前置きは不要です。
```

`{{...}}` はユーザーが差し込む可変部分。

---

## 8. Few-shot 例：ログイン機能の観点抽出

ここでは、LLMに期待する出力イメージとして、
簡単な **ログイン機能** の観点抽出例を示す。

### 8.1 想定ドキュメントの抜粋（例）

```text
3. ログイン機能

ユーザーはログイン画面から、ユーザーID とパスワードを入力してログインする。
両方の入力が正しい場合、メインメニュー画面に遷移する。

パスワードが誤っている場合、「ユーザーID またはパスワードが違います」というエラーメッセージを表示し、
ログイン画面に留まる。

同じユーザーIDで 5 回連続でログインに失敗した場合、アカウントロックとし、
管理者によるロック解除が必要となる。
```

### 8.2 期待するテスト観点出力例

```markdown
| viewpoint_id | category | sub_category | viewpoint_title | viewpoint_detail | test_classification | risk_score | risk_reason | source_reference | notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| VP-001 | ログイン | 正常 | 正しい資格情報でのログイン成功 | 正しいユーザーIDとパスワードを入力したときに、メインメニュー画面に遷移し、ログイン状態が維持されることを確認する。 | 正常系 | 5 | ログイン不可だとシステムを一切利用できず、全業務に影響するため。 | 利用手順書 3章 | 代表的な正常パターンとして必須。 |
| VP-002 | ログイン | エラーメッセージ | 間違ったパスワード時のエラーメッセージ表示 | 正しいユーザーIDに対して誤ったパスワードを入力した場合に、仕様どおりのエラーメッセージが表示され、画面がログイン画面のままであることを確認する。 | 準正常系 | 4 | 誤ったログイン時の挙動が適切でないと、不正アクセスの試行や利用者の混乱につながるため。 | 利用手順書 3章 | メッセージ文言の揺れが許容されるかは別途確認が必要。 |
| VP-003 | ログイン | アカウントロック | 一定回数のログイン失敗によるアカウントロック | 同一ユーザーIDで規定回数（例：5回）連続してログインに失敗した場合に、アカウントがロックされ、その後のログイン試行が拒否されることを確認する。 | 準正常系 | 5 | アカウントロックが機能しないと、不正アクセス防止の仕組みが弱まり、セキュリティリスクが高まるため。 | 利用手順書 3章 | 回数やロック解除条件は別途仕様書と整合性を確認する。 |
| VP-004 | ログイン | ロック状態 | ロックされたアカウントでのログイン拒否 | 既にアカウントロックされたユーザーIDでログインを試みた場合に、仕様どおりのエラーメッセージが表示され、ログインできないことを確認する。 | 異常系 | 4 | ロック状態の挙動が不適切だと、不正利用や運用混乱の原因となるため。 | 利用手順書 3章 | 管理者解除後の挙動は別観点で扱う。 |
```

このように、**1つの機能から複数の観点を正／準正／異常のバランスを見て抽出する**。

---

## 9. Few-shot 例：受注登録〜承認フローの観点抽出

### 9.1 想定ドキュメントの抜粋（例）

```text
5. 受注登録〜承認フロー

営業担当者は受注登録画面から、顧客・商品・数量・単価を入力して受注伝票を作成する。
伝票ステータスは初期状態で「入力中」となり、保存後に「申請中」に変更できる。

上長は承認画面から、申請中の受注伝票を一覧表示して内容を確認し、
問題なければ「承認」ボタンを押下する。

承認された受注伝票のみが、出荷処理の対象となる。
```

### 9.2 期待するテスト観点出力例（抜粋）

```markdown
| viewpoint_id | category | sub_category | viewpoint_title | viewpoint_detail | test_classification | risk_score | risk_reason | source_reference | notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| VP-101 | 受注登録 | 正常登録 | 必須項目を正しく入力した受注伝票の登録 | 顧客・商品・数量・単価など必須項目を正しく入力した場合に、受注伝票が保存され、ステータスが「入力中」→「申請中」に遷移できることを確認する。 | 正常系 | 5 | 受注登録が正常に行えないと、後続の出荷・売上処理が一切できなくなるため。 | 利用手順書 5章 | 申請ステータスの遷移条件は別途仕様書と照合が必要。 |
| VP-102 | 受注登録 | 入力バリデーション | 数量・単価の異常値入力時のエラー処理 | 数量が 0 やマイナス値、極端に大きな値の場合、または単価が許容範囲外の場合に、適切なエラーメッセージを表示し、伝票が保存されないことを確認する。 | 準正常系 | 4 | 金額計算の誤りや不正な取引登録を防止するため。 | 要件定義書 5.2節 | 許容範囲の具体値は仕様書に依存するため、notesに前提を明記する。 |
| VP-103 | 承認フロー | 正常承認 | 申請中の受注伝票の承認 | 上長ユーザーが承認画面で申請中の受注伝票を表示し、内容確認後に承認操作を行うと、ステータスが「承認済」となり、出荷処理の対象として表示されることを確認する。 | 正常系 | 5 | 誤承認や承認不能は業務全体の停止や誤出荷につながるため。 | 利用手順書 5章 | 承認権限ロールの確認観点とは分けて定義してもよい。 |
| VP-104 | 承認フロー | 権限 | 非承認者による承認操作の制御 | 承認権限を持たない一般ユーザーが承認画面にアクセス・承認操作を実行できないこと、または試行時に適切なエラーメッセージが表示されることを確認する。 | 異常系 | 5 | 権限逸脱により不正な承認が行われると重大な業務リスクになるため。 | 要件定義書 3.4節 | 実装されている権限モデルに応じて観点を分割することも検討する。 |
```

---

## 10. 実運用上の注意点

* 観点数が多くなりすぎた場合は、
  類似の観点をまとめて粒度を調整することも許容する。
* リスクスコアが高い観点（例：4 以上）については、
  `viewpoint_detail` と `risk_reason` を少しだけ丁寧に書く。
* 観点を抽出した後、

  * 「この観点は本当に業務上意味があるか」
  * 「単機能テストに落とし込みすぎていないか」
    を軽く自己チェックする。
* ドキュメントに記載のない前提（例：データ連携タイミング、外部システムの応答など）を仮定する場合は、
  `notes` に「この前提が異なる場合は観点を見直す必要がある」と明記しておく。

---

## 11. まとめ

このガイドの目的は、「LLMに対して、業務シナリオテストに使えるレベルのテスト観点を、
**分類とリスク情報付きで安定して引き出すこと** にある。

* 正常／準正常／異常のバランス
* 業務フロー単位の粒度
* リスクスコアとその理由

をセットで定義しておくことで、
後続の `test_scenario_design_guide.md` による **シナリオ設計フェーズ** で、
観点を選び、束ね、優先順位をつける作業がやりやすくなる。

このファイルはあくまで **「観点抽出専用」** のガイドであり、
シナリオ設計の詳細は `test_scenario_design_guide.md` で定義する。
