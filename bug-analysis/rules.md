# rules.md — 不具合チケットから品質状況を判定するための運用手順

## 0. 目的

進行中テストで検出された不具合チケットを入力として、

1. プロダクトの品質リスクを抽出し、2) プロジェクトの進行状況を評価し、3) 報告品質を点検し、
   4) **類似の不具合が潜在していないか**、5) **未検出の不具合が潜在していないか**を明らかにし、
   総合評価（S/A/B/C/D）と次のアクションを提示する。

> 原則：推測で補完しない。不明点は「8. 不明点の解消」で質問を返す。

---

## 1. 入力（データ仕様）

不具合チケットのレコード群。各レコードは以下のいずれか（可能な限り）を含む：

* タイトル、概要
* State（解決状況） / 完了日 / 完了理由
* Severity（重要度）
* 前提条件 / 再現手順 / 実施結果 / 期待される結果
* 発生環境（OS/ブラウザ/バージョン/テナント等）
* テストフェーズ（発見工程） / テスト種別
* 検出方法（テストケース/探索的/自動化 等）
* ブロッカー（true/false）
* 原因分類（設計/実装/テスト/他）
* 報告日 / 報告者
* （任意）モジュール／機能／画面 名、ラベル、リンク

> メモ：モジュール/機能/画面が直接無い場合は、ラベル・パス・タイトルの慣用表現から推定しても良いが、**推定結果は明記**する。

---

## 2. 出力（必須の成果物）

* **総合評価**：S / A / B / C / D
* **採点（各100点満点）**

  * プロダクト品質スコア（PQ）
  * プロジェクト状況スコア（PS）
  * 不具合報告の質・信頼度スコア（RQ）
* **抽出されたプロダクトリスク**（箇条書き・根拠リンク付き）
* **抽出されたプロジェクトリスク**（箇条書き・根拠リンク付き）

  * テスト開始日・終了予定日、テストケース消化状況などが与えられていれば加味
* **類似不具合パターンの分析**（同一原因・同一モジュール・同一機能での類似不具合の有無、潜在リスクの指摘）
* **未検出不具合の潜在リスク**（テストカバレッジの偏り、未テスト領域、検出方法の偏りから推測される未検出リスク）
* **不具合報告の質についての指摘**（必要なら報告者単位のフィードバック）
* **問題点の指摘**（要因仮説 / 運用上の詰まり）
* **次のアクション**（優先度つき To-Do）
* **質問（不明点の解消）**

> 形式：Markdown  
> 成果物となるmdファイルは `results` フォルダに出力する。

---

## 3. 指標の定義と集計（最低限）

以下は**必ず**集計する。表または短い箇条書きで出す。

1. **分布**

* モジュール別・機能別・画面別の不具合件数（Open/Closed 別、Sev 別）
* テストフェーズ（発見工程）別、テスト種別別の件数

2. **品質/運用シグナル**

* **Remove率**＝（無効/重複/再現不可/仕様通り）/ 全チケット
* **解決期間**（Closed のみ）：`完了日 − 報告日` の中央値 / p75
* **ブロッカー率**＝Blocked（もしくはブロッカー=true）/ 全チケット
* **非機能不具合の残存**（性能/セキュリティ/証明書/可用性 等のOpen数）
* （任意）再オープン率、重複率、欠陥到着曲線（週次Open/Close）、WIPのエイジング

3. **類似不具合・未検出リスクのシグナル**

* **類似不具合パターン**：同一モジュール/機能/画面での類似タイトル・類似原因の不具合件数、同一原因分類の集中度
* **検出方法の偏り**：テストケース検出 vs 探索的検出 vs 自動化検出の比率、未カバー領域の推定
* **テストフェーズ別の検出率**：フェーズごとの検出件数とテストカバレッジの関係、後工程での検出が多い場合の前工程未検出リスク
* **モジュール/機能別の検出密度**：不具合0件のモジュール/機能の存在、テスト実施状況との乖離
* **原因分類の偏り**：特定原因（設計/実装/テスト）への集中度、類似原因の不具合群の有無

> 日付は ISO 形式に正規化。タイムゾーンの混在があれば補正を明記。

---

## 4. スコアリング（100点満点 ×3）

**調整パラメータ**はプロジェクトに合わせて変更可。初期値を下に示す。

### 4.1 プロダクト品質スコア（PQ）

```
PQ = 100 
  − w1 * Sev12_Open_Pressure
  − w2 * BlockerRate_Score
  − w3 * NFR_Open_Score
  − w4 * ArrivalTrend_Risk
```

* `Sev12_Open_Pressure`：Sev1/2 の Open 比率を 0–100 に線形換算

  * 初期：`min(100, 100 * (Open(Sev1)*1.0 + Open(Sev2)*0.5) / max(1, 全Open))`
* `BlockerRate_Score`：`min(100, 100 * Blocked/全件)`
* `NFR_Open_Score`：非機能(Open) の割合を 0–100 に換算
* `ArrivalTrend_Risk`：直近2週で **Open−Close** が増勢なら 20、横ばい10、減勢0（簡易）
* 初期ウェイト：`w1=0.45, w2=0.25, w3=0.20, w4=0.10`
* 下限・上限は `clamp(PQ, 0, 100)`

### 4.2 プロジェクト状況スコア（PS）

```
PS = 100 
  − v1 * MTTR_Score 
  − v2 * Blocker_Aging_Score 
  − v3 * Throughput_Gap_Score
```

* `MTTR_Score`：解決期間中央値を基準（初期基準 5営業日）でスケーリング

  * 例：`min(100, 100 * 中央値日数 / 5)`
* `Blocker_Aging_Score`：Blocked の p75 経過日数を基準（初期 3営業日）でスケーリング
* `Throughput_Gap_Score`：直近週の `Open−Close` が正ならその幅を 0–100 に正規化
* 初期ウェイト：`v1=0.4, v2=0.35, v3=0.25`

### 4.3 不具合報告の質・信頼度スコア（RQ）

```
RQ = 100 
  − u1 * RemoveRate_Score 
  − u2 * MissingField_Score
  − u3 * DuplicateRate_Score
  − u4 * ReproQuality_Risk
```

* `RemoveRate_Score`：Remove率×100
* `MissingField_Score`：必須フィールド欠落率×100（再現手順/期待結果/環境/Severity/State）
* `DuplicateRate_Score`：重複ラベル比率×100
* `ReproQuality_Risk`：曖昧表現や主観形容詞が多い場合 10–30 を加点（簡易NLP）
* 初期ウェイト：`u1=0.45, u2=0.25, u3=0.20, u4=0.10`

### 4.4 総合評価ランク

総合点 `Overall = 0.5*PQ + 0.3*PS + 0.2*RQ`

* **S**: 90–100（重大Open希薄、スループット健全、報告も高品質）
* **A**: 80–89
* **B**: 70–79
* **C**: 60–69
* **D**: <60
  ※ ランクは**例外規則**を持つ：`Open(Sev1) > 0` か `Blocker率 ≥ 15%` なら **C未満に下げ止め**。

---

## 5. リスク抽出（観測シグナル → リスク仮説）

* **プロダクトリスク**：`risk_judgement_guide.md` を参照して、観測シグナル（集中・偏り・遅延・残存）から **具体的な故障モード** を言語化。

  * 形式：「観測 → リスク名 → 一言メモ → 根拠（チケットID/検索式）」
* **プロジェクトリスク**：欠陥到着曲線、MTTR、Blocked率、原因カテゴリ偏り等から **進め方のリスク** を抽出。

  * テスト開始日/終了予定日、ケース消化率が与えられていれば **進捗ベースライン** と比較する。
* **類似不具合の潜在リスク**：同一モジュール/機能/画面、同一原因分類、類似タイトル・再現手順の不具合群から、**同様の不具合が他箇所に潜在している可能性**を指摘。

  * 形式：「観測（類似パターン） → 潜在リスク名 → 調査推奨箇所 → 根拠（類似チケットID群）」
  * 例：同一APIエンドポイントでの複数不具合 → 他のエンドポイントでも同様の実装パターンが存在する可能性
* **未検出不具合の潜在リスク**：テストカバレッジの偏り、検出方法の偏り、不具合0件のモジュール/機能の存在から、**未検出の不具合が潜在している可能性**を指摘。

  * 形式：「観測（カバレッジ/検出方法の偏り） → 未検出リスク名 → 調査推奨領域 → 根拠」
  * 例：探索的テストでのみ検出 → テストケース未カバー領域に類似不具合が潜在する可能性

---

## 6. 報告品質レビュー（指摘ガイド）

該当レコードを**例示**しながら短く指摘する。必要に応じ**報告者別の傾向**も提示。

* 再現手順の欠落 / 期待結果が曖昧（「正しく」等の主観語）
* 発生環境の未記載 / バージョン不明
* Severityと影響度の不一致（Sev2なのに限定条件・回避策あり等）
* スクリーンショット/ログ/IDの欠落
* タイトルの粒度不統一（画面名なし、同義語揺れ）
* 重複検索不足の疑い（近似タイトル多数）
* Remove理由の不明瞭さ（分類の基準不統一）

> 望ましい指摘の形：**現象** → **なぜ困る** → **どう直す**（テンプレ・例文・タグ統一）

---

## 7. 次のアクション（優先度つき）

* **P0（今すぐ）**：Sev1/2のOpenの封じ込め、Blocked解消のための決定（データ/環境の即応）
* **P1（短期）**：集中モジュールの追加回帰・境界値再設計、NFR（性能/権限等）の再検証計画
* **P2（中期）**：重複/Remove多発への運用是正（命名規則、検索訓練、テンプレ刷新、自動バリデーション）
* **類似不具合の探索**：同一モジュール/機能/画面、同一原因分類での類似不具合の有無を調査（検索キーワード・パターン例を提示）
* **未検出リスクの調査**：不具合0件のモジュール/機能のテスト実施状況確認、検出方法の偏りがある領域の追加テスト計画

> それぞれに**担当/期日/期待アウトカム**を1行で添える。

---

## 8. 不明点の解消（質問の作成ルール）

推測で埋めない。欠落が評価に影響する場合は**短く具体的**に質問する。例：

* モジュール/機能/画面の正規化ルールはある？（無いなら暫定マッピング提示可否）
* テスト開始日/終了予定日、現在のケース消化率は？
* 非機能（性能/セキュリティ等）ラベルの定義は？
* Blocked の定義（再現環境待ち/他チーム待ち/仕様確認待ちの区別）は？
* Remove 理由の分類基準は？
* 重複判定の運用（検索キーワード/既知事象リスト）は？

---

## 9. 手順（LLMの実行フロー）

1. **取り込み・正規化**：フィールド名を標準化。日付を ISO。ラベル揺れを正規化。
2. **分布集計**：3. の最低限指標を集計（表と短評）。類似不具合パターン・検出方法の偏りも集計。
3. **スコア計算**：4. の式で PQ/PS/RQ と総合ランクを算出（パラメータは明示）。
4. **リスク抽出**：5. の形式でプロダクト/プロジェクトリスクを列挙（各リスクに根拠リンク）。**類似不具合の潜在リスク**と**未検出不具合の潜在リスク**も抽出。
5. **報告品質レビュー**：6. に従い、具体例付きで短く指摘。
6. **次のアクション**：7. に従い、P0/P1/P2 のTo-Doを作成。類似不具合の探索・未検出リスクの調査も含める。
7. **不明点**：8. のガイドに沿って質問を提示。
8. **最終整形**：不要節は省略。表は見やすい列順に。略語は初出で説明。

---

## 10. 出力テンプレート（コピペ可）

```markdown
# 品質状況サマリ
- 総合評価：**A**
- PQ: 84 / PS: 78 / RQ: 72
- 評価メモ（1–3行）：…

## 指標スナップショット
- 期間：YYYY-MM-DD 〜 YYYY-MM-DD
- 件数：Open X / Closed Y（総 Z）
- Remove率：R%
- ブロッカー率：B%
- 解決期間（中央値/p75）：M / P75 日
- 非機能(Open)：N 件（性能 a / セキュリティ b / 他 c）

### 分布（モジュール別 × Severity）
| モジュール | Sev1 Open | Sev2 Open | Sev3 Open | 合計 Open | 備考 |
|---|---:|---:|---:|---:|---|
| ... |  |  |  |  |  |

### 分布（テストフェーズ / 種別）
| 軸 | 件数 | 備考 |
|---|---:|---|
| フェーズA |  |  |
| 種別B |  |  |

## 抽出されたプロダクトリスク
- 観測：… → リスク：「…」 → メモ：「…」 ※根拠: #123, #456

## 抽出されたプロジェクトリスク
- 観測：… → リスク：「…」 → メモ：「…」 ※根拠: …

## 類似不具合パターンの分析
- 観測：モジュールAで同一原因の不具合が3件検出 → 潜在リスク：「モジュールAの類似実装箇所に同様の不具合が存在する可能性」 → 調査推奨：モジュールAの類似API/画面/機能 ※根拠: #123, #456, #789
- 観測：同一エラーメッセージの不具合が複数 → 潜在リスク：「共通処理での不具合が複数箇所に影響している可能性」 → 調査推奨：エラーハンドリング共通処理 ※根拠: #111, #222

## 未検出不具合の潜在リスク
- 観測：モジュールBで不具合0件だがテストケース消化率が低い → 未検出リスク：「モジュールBに未検出の不具合が潜在している可能性」 → 調査推奨：モジュールBの追加テスト実施 ※根拠: テストカバレッジデータ
- 観測：探索的テストでのみ検出、テストケース検出が少ない → 未検出リスク：「テストケース未カバー領域に類似不具合が潜在する可能性」 → 調査推奨：テストケースの見直し・追加 ※根拠: 検出方法別集計

## 不具合報告の質についての指摘
- 例：Issue #789 — 再現手順の前提不足（環境バージョン未記載）→ テンプレの「環境」必須化

### 報告者ごとのフィードバック（必要時）
- @reporterA：重複率が高い（x%）。検索語例：「…」

## 問題点の指摘
- 例：Blocked の定義が曖昧で、老朽 Blocked が解消されない など

## 次のアクション
- P0：Sev1/2 Open の封じ込め（担当：X、期日：YYYY-MM-DD、完了条件：…）
- P1：性能タグのOpen 3件→再現データ×期間の設計見直し（担当：…）
- 類似不具合の探索：モジュールAの類似実装箇所での同様不具合の有無を調査（担当：Y、期日：YYYY-MM-DD、完了条件：類似パターン検索結果のレビュー完了）※検索キーワード例：「API」「エラーハンドリング」「モジュールA」
- 未検出リスクの調査：モジュールBのテスト実施状況確認と追加テスト計画（担当：Z、期日：YYYY-MM-DD、完了条件：テストカバレッジ確認と追加テスト実施）

## 質問（不明点）
1. …？
2. …？
```

---

## 11. 調整パラメータ（初期値）

* 重大度圧（`w1=0.45`）、ブロッカー（`w2=0.25`）、NFR（`w3=0.20`）、到着トレンド（`w4=0.10`）
* MTTR 基準：5営業日 / Blocked p75 基準：3営業日
* 例外規則：`Open(Sev1)>0` または `Blocked率≥15%` → ランクは C 以下に下げ止め

---

## 12. 参考

* リスクの言い換え・着眼点は **risk_judgement_guide.md** を参照。
* 指標の式・基準は目的に合わせて少しだけカスタマイズして良い。変更点は「評価メモ」で明記。
