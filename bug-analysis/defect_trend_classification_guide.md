# 不具合傾向分類ガイドライン

## 1. ガイドの目的

このガイドは、不具合チケットを以下の観点で一貫して分類し、不具合の「発生傾向」を分析しやすくすることを目的とする。

- どのモジュール・機能・画面で発生しているか（位置情報）
- どのような事象として現れているか（事象カテゴリ）
- どのような原因に起因していそうか（原因カテゴリ）
- どの業務・ビジネスプロセスに関係しているか（業務軸）

LLM は本ガイドに従って、不具合チケットを標準化されたカテゴリに分類し、その結果をもとに傾向分析を行う。

> 注: プロジェクト固有のモジュール名や業務名などは、本ファイル末尾の「8. プロジェクト固有の定義」のセクションに追記して運用すること。

---

## 2. 分類の前提と基本ルール

### 2.1 入力として想定する情報

不具合チケットには、少なくとも以下のような情報が含まれていることを前提とする。

- タイトル、概要
- 前提条件
- 再現手順
- 実施結果 / 期待結果
- 発生環境
- テストフェーズ
- テスト種別
- 検出方法
- 原因分類（あれば）
- モジュール / 機能 / 画面 に相当する情報（あれば）

これらの情報をもとに、本ガイドで定義する分類軸へマッピングを行う。

### 2.2 LLM に求める基本方針

- **推測で補完しないこと**
  - モジュール名や業務名がチケットから明確に読み取れない場合、「不明」と記録するか、ユーザーに質問する。
- **チケット記載内容を優先すること**
  - すでに `Module` や `Feature` フィールドが存在する場合は、それを尊重しつつ、本ガイドのカテゴリへマッピングする。
- **分類は「主」と「副」を区別すること**
  - 例: 「主に影響を受けるモジュール」と「連鎖的に影響を受けるモジュール」がある場合、主となるモジュールを 1 つ選び、副を必要に応じて列挙する。
- **あいまいな場合は慎重に扱うこと**
  - どのカテゴリにもきれいに当てはまらない場合は、「最も近いもの」を 1 つ選び、その理由をコメントとして残す。

---

## 3. 分類軸の全体像

本ガイドでは、以下の分類軸を定義する。

1. **位置情報軸**
   - プロダクト / サブシステム
   - モジュール
   - 機能
   - 画面 / API / バッチ / ジョブ種別

2. **不具合事象軸（事象カテゴリ）**
   - ユーザーから見える「どんな不具合か」を表現するカテゴリ

3. **原因軸（原因カテゴリ）**
   - 仕様 / 設計 / 実装 / 設定 / データ / テスト / 運用 などの観点での分類

4. **業務・ビジネスプロセス軸**
   - どの業務フロー・業務イベントの中で発生しているか

5. **補助的な軸（既存フィールドの正規化）**
   - テストフェーズ
   - テスト種別
   - 検出方法

位置情報軸と事象軸が特に重要であり、発生傾向の分析ではこの 2 つを主軸として扱う。

---

## 4. 位置情報軸の分類ルール

### 4.1 階層構造の考え方

位置情報は、可能であれば以下のような階層構造で整理する。

| レベル | 項目               | 例                                       |
|--------|--------------------|------------------------------------------|
| L1     | プロダクト         | 会計システムA、B2C ECサイト、社内ポータル |
| L2     | サブシステム       | 売上管理、在庫管理、認証基盤              |
| L3     | モジュール         | 受注入力、請求書発行、ユーザー管理       |
| L4     | 機能               | 受注明細登録、CSV 取込、権限ロール編集   |
| L5     | 実体               | 画面 ID、API エンドポイント、バッチ名    |

LLM はチケット情報からできる限りこの階層に落とし込み、少なくとも以下の 2 レベルは特定することを目指す。

- 必須: モジュール（L3）または機能（L4）
- 可能なら: 画面 / API / バッチ（L5）

### 4.2 位置情報の抽出手順

1. **明示的なフィールドの利用**
   - チケットに `Module` / `Feature` / `ScreenID` 等のフィールドがある場合、それをそのまま利用し、本ガイドの階層へマッピングする。
2. **タイトル・概要からの推定**
   - タイトルや概要にモジュール名が含まれている場合、それをモジュールとして扱う。
   - 例: 「受注登録画面での金額表示不具合」 → モジュール: 受注登録、機能: 金額表示、画面: 受注登録画面
3. **再現手順からの推定**
   - 再現手順の中に「どの画面を開くか」「どのメニューを選択するか」が書かれている場合、それを機能・画面として抽出する。
4. **不明な場合の扱い**
   - いずれの情報からもモジュールを特定できない場合、`Module: 不明` と明示し、推測で補完しない。

### 4.3 複数モジュールにまたがる場合のルール

- 複数のモジュールにまたがる場合は、以下のルールで分類する。
  1. 事象が初めて顕在化するモジュールを「主モジュール」とする。
  2. 連鎖的に影響を受けるモジュールは「副モジュール」としてリストに記載する。
- 例:
  - 受注登録で誤ったデータが保存され、その後の請求書発行で金額誤りが発生した場合  
    - 主モジュール: 受注登録  
    - 副モジュール: 請求書発行  

---

## 5. 不具合事象軸（事象カテゴリ）の定義

### 5.1 事象カテゴリ一覧

事象カテゴリは、ユーザーから見た「どのような現象として現れているか」を分類する。

| コード | カテゴリ名                     | 説明・典型例 |
|--------|--------------------------------|-------------|
| E01    | 計算ロジック不正              | 合計値・税額・端数処理・為替レートなどの計算誤り |
| E02    | 入力チェック・バリデーション不足 | 必須項目未チェック、桁数・形式チェック不足、異常値受け入れ |
| E03    | データ整合性・不整合           | マスタ不整合、重複登録、整合性制約違反、履歴が残らない等 |
| E04    | 画面表示・UI レイアウト崩れ   | 項目のずれ、見切れ、レスポンシブ時の崩れ、ラベル誤記 |
| E05    | 画面遷移・状態管理不正         | 画面遷移不可、戻るボタン挙動不正、セッション切れの誤処理 |
| E06    | 性能・レスポンス遅延          | 画面表示が極端に遅い、タイムアウト、バッチの長時間実行 |
| E07    | エラー処理・メッセージ不備      | 例外未ハンドリング、スタックトレース露出、誤ったエラーメッセージ |
| E08    | 権限・アクセス制御不備        | 権限のない操作が可能、逆に権限があっても操作できない |
| E09    | セキュリティ関連問題          | 脆弱なパスワードポリシー、CSRF/XSS/SQLi などの脆弱性 |
| E10    | 互換性・環境依存動作          | 特定ブラウザ/OS/解像度でのみ発生する不具合 |
| E11    | バッチ・ジョブ異常            | バッチ異常終了、スケジュール未実行、リトライ不備 |
| E12    | 設定・パラメータミス           | コンフィグ値不正、環境設定の抜け・誤りに起因する事象 |
| E13    | ドキュメント・ヘルプ不備      | マニュアルと実装が乖離、ヘルプの誤記・不足 |
| E99    | その他 / 分類不能              | 上記のいずれにも当てはまらない、もしくは情報不足で判断困難なもの |

### 5.2 事象カテゴリの選び方

- 原則として「ユーザー視点で最も直接的に認識される事象」を 1 つ選ぶ。
  - 例: 計算結果が誤っている → E01 計算ロジック不正
  - 例: 入力制限がないために不正な値が保存される → E02 入力チェック不足（原因が設計でも実装でも、事象としてはバリデーション不足）
- 2 つ以上に当てはまりそうな場合は、以下を参考にする。
  - 主: 最初に顕在化する事象
  - 副: その結果として起こる二次的事象（必要に応じてコメントとして記載）

---

## 6. 原因軸（原因カテゴリ）の定義

チケットに既に原因分類がある場合はそれを尊重しつつ、ない場合や粗すぎる場合には、以下のカテゴリを補助的に用いる。

| コード | カテゴリ名         | 説明 |
|--------|--------------------|------|
| C01    | 要件・仕様起因     | 要件定義の抜け・曖昧さ、仕様の矛盾 |
| C02    | 設計起因           | 画面設計・DB 設計・アーキ設計の不備 |
| C03    | 実装起因           | コーディングミス、ライブラリの誤用 |
| C04    | 設定・インフラ起因 | 設定ファイル誤り、環境差異、インフラ構成ミス |
| C05    | データ起因         | マスタデータ不備、移行データの問題、テストデータ不備 |
| C06    | テスト起因         | テストケース不備、テスト実施ミス、観点漏れ |
| C07    | 運用・手順起因     | 手順書不備、運用ミス、教育不足 |
| C99    | 不明 / 判定不能    | チケット情報のみからは判断できない場合 |

### 6.1 原因カテゴリの判定ルール

- チケットに「原因」や「根本原因」が明記されている場合は、それを優先してマッピングする。
- 記載がない場合でも、明らかに判断できるケース（例: コード typo で NPE）は C03 実装起因としてよい。
- 判断が分かれそうな場合は、無理に決めず C99 とし、「判断に必要な追加情報」の例をコメントとして挙げる。

---

## 7. 業務・ビジネスプロセス軸の定義

### 7.1 業務カテゴリの例

業務・ビジネスプロセスに基づく分類は、プロダクトごとに異なるため、以下はテンプレート例とする。

| コード | カテゴリ名               | 説明・例 |
|--------|--------------------------|----------|
| B01    | マスタ登録・メンテナンス | 顧客マスタ、商品マスタ、ユーザーマスタ等 |
| B02    | 取引・トランザクション   | 受注、売上、仕入、支払、入金 等 |
| B03    | 集計・締め処理           | 月次締め、年次決算、在庫評価 等 |
| B04    | レポート・帳票出力       | 帳票出力、エクスポート、帳票レイアウト |
| B05    | 認証・認可・ユーザー管理 | ログイン、権限設定、パスワード管理 |
| B06    | 外部連携・インタフェース | 外部 API 連携、ファイル連携、EDI 等 |
| B07    | システム管理・設定       | システム設定、ロール管理、ログ閲覧 等 |
| B99    | その他 / 不明            | 上記に当てはまらない、もしくは情報不足 |

### 7.2 業務カテゴリの判定ルール

- 再現手順や前提条件から、「ユーザーが何の業務をしている場面か」を読み取り、最も近いカテゴリを選ぶ。
- プロジェクト固有の業務カテゴリがある場合は、「8. プロジェクト固有の定義」に追記し、そちらを優先する。

---

## 8. 補助軸（テストフェーズ / 種別 / 検出方法）の正規化

既存フィールドを使用するが、プロジェクトごとに表記ゆれが生じるため、以下のように正規化する。

### 8.1 テストフェーズ

| 正規化後 | 例としてマッピングする値 |
|----------|--------------------------|
| 単体     | UT, Unit, 単体テスト      |
| 結合     | IT, Integration, 結合テスト|
| システム | ST, System, 総合テスト   |
| 受け入れ | UAT, User Test, 受入     |
| 本番     | Production, 運用中        |

### 8.2 テスト種別（例）

| 正規化後         | 例としてマッピングする値 |
|------------------|--------------------------|
| 機能テスト       | Function, 機能           |
| 業務シナリオテスト | Scenario, E2E, 業務    |
| 回帰テスト       | Regression               |
| 性能テスト       | Performance, 負荷        |
| セキュリティテスト | Security                |
| 互換性テスト     | Compatibility, Browser   |
| 探索的テスト     | Exploratory             |
| 自動テスト       | Automation, E2E Auto, UT Auto 等 |

### 8.3 検出方法（例）

| 正規化後 | 例としてマッピングする値 |
|----------|--------------------------|
| テストケース | 手順書あり、Scripted    |
| 探索的       | Ad-hoc, Session-based   |
| 自動テスト   | CI, 自動, Automation    |
| モニタリング | 監視, アラート          |
| ユーザー申告 | 問い合わせ, インシデント |

---

## 9. LLM 向けの分類手順サマリ

LLM が 1 件の不具合チケットを分類する際は、以下の順で判断する。

1. **位置情報軸**
   - タイトル / 概要 / 再現手順から、モジュール・機能・画面を抽出し、L3〜L5 のいずれかにマッピングする。
2. **不具合事象軸（事象カテゴリ）**
   - ユーザーが最初に認識する不具合の種類を特定し、E01〜E99 のいずれかを選択する。
3. **原因軸（原因カテゴリ）**
   - チケット内の原因記述をもとに C01〜C99 にマッピングする。判断困難な場合は C99。
4. **業務・ビジネスプロセス軸**
   - 再現手順から業務シナリオを読み取り、B01〜B99 のいずれかを選択する。
5. **補助軸**
   - テストフェーズ / テスト種別 / 検出方法を正規化する。

---

## 10. プロジェクト固有の定義（追記用）

> このセクションは、プロジェクトごとに固有の情報を追記して利用する。

### 10.1 モジュール・機能一覧（例）

- 売上管理
  - 売上登録
  - 売上訂正
  - 売上確定
- 請求管理
  - 請求書発行
  - 請求データ出力

### 10.2 業務カテゴリの上書き / 追加

- B02 取引・トランザクション
  - 受注登録、売上計上、入金処理を含む
- B08 会計・決算関連
  - 振替伝票入力、決算整理仕訳、連結処理 等

### 10.3 用語集

- 「受注」: 顧客からの注文情報を登録する業務。モジュール「受注管理」に属する。
- 「仕訳」: 会計上の取引を記録する単位。モジュール「仕訳入力」に属する。
