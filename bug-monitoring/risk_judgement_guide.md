# risk_judgement_guide.md — 不具合チケットから推定するリスク辞書

## 0) 使い方（30秒版）

1. 期間を決めてチケットを集計（Open/Closed、Sev、ラベル、原因、Blocked、工程）。
2. 下表の「検出式/しきい値」に当てる（SQL/WIQL/集計で代替OK）。
3. 該当した行を「観測 → リスク → メモ → 根拠（#ID）」形式で抽出。
4. 重要度は **Sev×残存数×集中度** の三点で並べ替える。

---

## 1) プロダクトリスク（品質の中身）

> タグ例：`ProductRisk/*`（任意）

### 1.1 機能正しさ／計算整合

* **観測**：Sev1/2 が特定モジュールに集中（会計計算、課税、在庫評価 等）
* **リスク**：計算誤り・整合性リスク
* **メモ**：丸め・端数・境界値（0/負/最大桁）で破綻しやすい
* **検出式/しきい値**：`Top1モジュールのSev1-2 Open比 ≥ 35%`
* **アクション**：境界値拡張の追加回帰セット、仕様の端数規則を例示付きで明文化

### 1.2 データ整合／移行

* **観測**：「データ不整合」「移行」「マッピング」系ラベルが残存
* **リスク**：移行・互換性リスク
* **メモ**：本番切替時に致命。ロールバック計画と監査ログが鍵
* **検出式**：`label in {data-migration,data-integrity}` の Open ≥ 3 かつ 高齢化 p75≥7日
* **アクション**：移行ベリファイ手順の増補、差分ダンプ比較、監査項目の先行試行

### 1.3 性能・スケーラビリティ

* **観測**：タイムアウト、p95>目標、夜間バッチ遅延
* **リスク**：SLI/SLO 未達
* **メモ**：データ量×期間の長い帳票が地雷
* **検出式**：`label in {performance,timeout}` Open ≥ 2 かつ フェーズ後半で検出
* **アクション**：ボトルネック計測→クエリ/インデックス改善、負荷前提データの標準化

### 1.4 セキュリティ／権限

* **観測**：未承認アクセス、権限逸脱、認証まわりが未解決
* **リスク**：権限逸脱・監査不適合
* **メモ**：役割×操作のマトリクスから逆引き
* **検出式**：`label in {security,auth,authorization}` の Open > 0（例外規則で評価ダウン）
* **アクション**：権限マトリクスの網羅テスト化、監査イベント観点の追補

### 1.5 可用性・リライアビリティ

* **観測**：クラッシュ、リトライ不足、ネットワーク断で復帰しない
* **リスク**：回復性不足
* **メモ**：サーキットブレーカ/リトライ/フォールバック設計の欠落
* **検出式**：`label in {reliability,crash,retry}` Open ≥ 2
* **アクション**：失敗注入テスト、リトライ戦略・アイドルタイムアウトの明文化

### 1.6 外部依存／API

* **観測**：外部API/サードパーティ起因の失敗が散発
* **リスク**：外部依存リスク（可用性/レート/バージョン差異）
* **メモ**：ステータスコードと再試行方針の不在が典型
* **検出式**：`label in {external,third-party,api-failure}` Open ≥ 2
* **アクション**：バージョン固定、レート制限試験、フォールバック経路の設計

### 1.7 ローカライズ／多通貨／時間帯

* **観測**：多言語・通貨・TZ 関連の塊発生
* **リスク**：表記/丸め/集計の地域依存バグ
* **メモ**：UTC⇄ローカル境界、月末月初、うるう秒
* **検出式**：`label in {i18n,l10n,currency,timezone}` Open ≥ 2
* **アクション**：通貨丸め規則の表化、TZ切替のクロスデイ境界テスト

### 1.8 アクセシビリティ/UX

* **観測**：重複チケット多発＋ユーザー起票に偏り、A11yが低優先で滞留
* **リスク**：認知負荷高・要件不適合
* **メモ**：同質の迷いがUIに潜む合図
* **検出式**：`duplicate率 ≥ 10%` かつ `label in {a11y,usability}` Open 残存
* **アクション**：用語/ラベル統一、フォーカス順/コントラスト点検、ガイドのUI内埋め込み

### 1.9 競合・同時実行

* **観測**：同一レコードの同時編集で不整合
* **リスク**：ロストアップデート/二重実行
* **メモ**：楽観/悲観制御の設計見落とし
* **検出式**：`label in {concurrency,optimistic-lock}` Open ≥ 1
* **アクション**：バージョン列導入、差分マージ、衝突解決UI

### 1.10 設定/環境依存

* **観測**：環境特有（本番だけ/特定ブラウザだけ）で再現
* **リスク**：構成差異・設定逸脱
* **メモ**：Feature Flag / 設定ドリフト
* **検出式**：`env=prod only` または `browser specific` 起票比率 ≥ 30%
* **アクション**：設定監査、Flag一覧と既定値の棚卸し

---

## 2) プロジェクトリスク（進め方・体制）

> タグ例：`ProjectRisk/*`（任意）

### 2.1 スケジュール滑り

* **観測**：欠陥到着曲線が増勢（Open−Close>0）が3サイクル継続
* **リスク**：計画遅延
* **メモ**：凍結ルールが緩い、修正と新規が干渉
* **検出式**：`(Open_t - Close_t) > 0` を3週連続
* **アクション**：コードフリーズ強化、修正ウィンドウ分離

### 2.2 MTTR長期化 / Blocked高止まり

* **観測**：解決期間中央値が基準超、Blocked率が高い
* **リスク**：環境/データ/意思決定ボトルネック
* **メモ**：再現データの前処理に詰まりがち
* **検出式**：`MTTR中央値 ≥ 5営業日` または `Blocked率 ≥ 15%`
* **アクション**：再現データ自動生成、環境プロビジョニングSLA

### 2.3 原因カテゴリの偏り

* **観測**：「要件不備」「仕様未定」が多い
* **リスク**：上流成熟不足
* **メモ**：レビュー→仕様反映のリードタイム遅延
* **検出式**：`root_cause=requirements` 比率 ≥ 30%
* **アクション**：受入条件（AC）の質向上、例外表の拡充

### 2.4 再オープン・品質ばらつき

* **観測**：再オープン率 > 15%／担当偏り
* **リスク**：レビュー品質のばらつき・属人化
* **メモ**：観点チェック不足
* **検出式**：`reopen/close ≥ 0.15`
* **アクション**：ペアレビュー、チェックリスト適用、修正完了の定義DoD明確化

### 2.5 重複多発・トリアージ摩耗

* **観測**：Duplicate率 > 10%
* **リスク**：WIP膨張、探索効率低下
* **メモ**：命名規則と検索訓練の不足
* **検出式**：`state=removed(reason=duplicate)/all ≥ 0.10`
* **アクション**：テンプレ刷新、類似検索の自動提示

### 2.6 下流偏重（UAT/本番での検出過多）

* **観測**：UAT/Prod 起票比が計画を超過
* **リスク**：上流テストの網羅不足
* **メモ**：シナリオ/データ設計が浅い
* **検出式**：`phase in {UAT,Prod}` 比率 ≥ 20%（計画比）
* **アクション**：業務シナリオ再設計、データカバレッジ強化

### 2.7 NFRの後倒し

* **観測**：性能/セキュリティが後工程まで未着手
* **リスク**：後戻り高コスト
* **メモ**：ゲート条件が無い
* **検出式**：`label in {performance,security}` がフェーズ末期に初検出
* **アクション**：NFRゲート、早期計測の定例化

### 2.8 自動化/CIの信頼性低下

* **観測**：フレークテスト高率、CI失敗が継続
* **リスク**：偽陽性で検出遅延
* **メモ**：テスト安定化優先が必要
* **検出式**：`flaky_rate ≥ 5%` または `ci_fail_streak ≥ 3`
* **アクション**：不安定テスト隔離、リトライ/タイムアウト調整、診断ログ強化

### 2.9 コミュニケーション/責任境界

* **観測**：Blocked理由が「確認待ち/他チーム待ち」に偏る
* **リスク**：意思決定レイテンシ
* **メモ**：RACIの曖昧さ
* **検出式**：`blocked_reason in {spec,other-team}` 比率 ≥ 60%
* **アクション**：週次トリアージに決裁者参加、RACI再定義

---

## 3) 早見表テンプレ（抽出用）

```
- 観測：<短い事実> 
  → リスク：「<名前>」
  → メモ：「<一言で弱点や背景>」
  → しきい値/検出式：<式 or 比率>（期間：YYYY-MM-DD〜YYYY-MM-DD）
  ※根拠：#123, #456
```

---

## 4) しきい値・集計の補助メモ

* **集中度**：Top1 モジュールの割合、Top3 累積割合（例：Top1≥35% or Top3≥60%）
* **高齢化**：`経過日数 p75` を使うと外れ値に強い
* **比率**：分母は「期間内の全起票」か「Open」のどちらかで統一
* **到着曲線**：週次 `Open - Close` の推移（3点移動平均でノイズ除去）
* **例外規則**：`Open(Sev1)>0` または `security Open>0` は総合評価を下げ止め（rules.md参照）

---

## 5) 用語最小集

* **Sev**：重大度。Sev1=致命、Sev2=高、Sev3=中…
* **MTTR**：Mean Time To Resolve（解決までの平均/中央値推奨）
* **NFR**：Non-Functional Requirements（性能/セキュリティ/可用性 等）
